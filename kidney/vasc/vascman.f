	PROGRAM VASCMAN
C  PROGRAM TO READ VASC.DAT FROM VASC
C    UNITS CHANGED FROM NMOL/S TO MUMOL/MIN
C
C  Calculation plan: 
C  SDVR -> SAVR (1,2)
C  LDVR(OM) -> LDVR(IM) -> LAVR(IM) -> LAVR(OM) (3,7)
C  MRDVR -> MRAVR (8)
C
C  In all, there are 4 short vessel segments, 20 long vessel segments,
C     and 2 MR vessel segments = 26.
C  In will be read as named data in anticipation for processing.
C
C Segment numbers (ISEG)
C      1- OMDVR,OIDVR,MRDVR
C      2- IMDVR
C      3- IMAVR
C      4- OMAVR,OIAVR,MRAVR
C
C Plan for 24000 SF nephrons (@30 nl/min -> 720 mul/min) 
C    12400 JM nephrons (@60 nl/min -> 720 mul/min) 
C     Of the 12000 JM, turns can parallel CD coning:
C    1 mm 6400
C    2 mm 3200
C    3 mm 1600
C    4 mm  800
C    5 mm  400
C
C PROGRAM TO CONSOLIDATE THE VR INTO FULL MEDULLARY VASCULATURE 
C Plan for 36000 OMDVR = 24000 sDVR + 12000 lDVR ~ about 3x JM glomeruli
C           7200 MRDVR (DVR from 24000 SF glom = 72000, so this is 10%)  
C Plan for 72000 OMAVR, 24000 IMAVR, 14400 MRAVR; AVR are 2x the DVR number
C  OM and IM DVR derive from 12000 JM nephrons; MR DVR from 2400 SF nephrons
C  Of the IM vessels, turns parallel those of the nephron
C         IMDVR       IMAVR
C    1 mm  6000       12000
C    2 mm  3000        6000
C    3 mm  1500        3000
C    4 mm   750        1500
C    5 mm   375         750
C
C Index to solutes in FKC:
C	FKC(1)='  NA '
C	FKC(2)='  K  '
C	FKC(3)='  CL '
C	FKC(4)=' HCO3'
C	FKC(5)='H2CO3'
C	FKC(6)=' CO2 '
C	FKC(7)=' HPO4'
C	FKC(8)='H2PO4'
C	FKC(9)=' UREA'
C	FKC(10)=' NH3 '
C	FKC(11)=' NH4 '
C	FKC(12)='  H  '
C	FKC(13)=' HCO2'
C	FKC(14)='H2CO2'
C	FKC(15)=' GLUC'
C	FKC(16)=' IMPC'
C	FKC(17)='  TA '
C	FKC(18)=' NAE '
C
C For this program, the file vasc.dat will be read into archive
C and then output according to (vessel,segment,distance)
C
C CAPILLARY VARIABLES
        INTEGER SOLS,CHOP,DCHOP,JWR(20),
     1    RCHOP(10,4),RDCHOP(10,4)
        DOUBLE PRECISION RADVR(8),RDNUM(8),RANUM(8)
C
	DOUBLE PRECISION RDIST(10,4,901),
     1   RVC(10,4,901),RPC(10,4,901),RCC(10,4,31,901),
     1   RIMPC(10,4,901),RLCHC(10,4,901),RXC(10,4,15,901),
     1   RFVC(10,4,901),RFKC(10,4,31,901),RFVCS(10,4,901),
     1   RFKCS(10,4,16,901),RHCTC(10,4,901),RFBC(10,4,901),
     1   RTA(10,4,901),RFTA(10,4,901),RNAE(10,4,901),ROSMC(10,4,901)
C
	DOUBLE PRECISION DIST(901),
     1   VC(901),PC(901),CC(31,901),IMPC(901),
     1   LCHC(901),XC(15,901),FVC(901),FKC(31,901),
     1   QV,QC(31),FVCS(901),FKCS(16,901),
     1   HCTC(901),FBC(901),TA(901),FTA(901),
     1   NAE(901),FNAE(901),OSMC(901)
C
	DOUBLE PRECISION 
     1   WRRES(10,4,10),WRDL(10,4,10),WREX(10,4,10),
     1   RDPAGE(60,901),WRPAGE(10,901),SCAL(20)
C
        CHARACTER*12 IPTFIL,OPTFIL,VARNAM
        CHARACTER*5 VNAME1(20),VNAME2(20),SWI,SWO,
     1    SEGOM(2),SEGIM(4),SEGMR(2),VRNAM(10),BARNAM(12)
C
	COMMON/TWR/CHOP,DIST,
     1   VC,PC,CC,IMPC,LCHC,XC,HCTC,OSMC,
     1   FVC,FKC,FBC,QC,QV,FVCS,FKCS,
     1   TA,NAE,FTA,FNAE
C
	DATA 
     1    SEGOM /'omdvr','omavr'/
     1    SEGIM /'oidvr','imdvr','imavr','oiavr'/
     1    SEGMR /'mrdvr','mravr'/
     1    VRNAM  /'  om1','  om2',
     1    '  im1','  im2','  im3','  im4','  im5',
     1    '   mr','allom','allim'/
C
        SOLS=15
C
        IPTFIL = 'vasc.dat'
	OPEN(1,FILE=IPTFIL)

	OPEN (2,FILE='vrnum.dat')
        READ (2,25) (RADVR(I),RDNUM(I),I=1,8)
   25   FORMAT(2D12.4)
        DO 26 I=1,8
   26   RANUM(I)=RDNUM(I)*RADVR(I)
C
	OPEN(3,FILE='vrmesh.dat')
        READ (3,8) (RCHOP(1,ISEG),RDCHOP(1,ISEG),ISEG=1,2)
        READ (3,8) (RCHOP(2,ISEG),RDCHOP(2,ISEG),ISEG=1,2)
        DO 5 IVR=3,7
    5   READ (3,8) (RCHOP(IVR,ISEG),RDCHOP(IVR,ISEG),ISEG=1,4)
        READ (3,8) (RCHOP(8,ISEG),RDCHOP(8,ISEG),ISEG=1,2)
    8   FORMAT(8I5)
C
        OPEN(20,FILE='xy.na')
        OPEN(21,FILE='xy.k')
        OPEN(22,FILE='xy.hco3')
        OPEN(23,FILE='xy.nh4')
        OPEN(24,FILE='xy.nae')
        OPEN(25,FILE='xy.urea')
        OPEN(26,FILE='xy.h2o')
        OPEN(30,FILE='bars.na')
        OPEN(31,FILE='bars.k')
        OPEN(32,FILE='bars.hco3')
        OPEN(33,FILE='bars.nh4')
        OPEN(34,FILE='bars.nae')
        OPEN(35,FILE='bars.urea')
        OPEN(36,FILE='bars.h2o')
        OPEN(40,FILE='vtab.dat')
C
C DATA FOR EACH SEGMENT IS READ: 
C  SDVR -> SAVR (1,2)
C  LDVR(OM) -> LDVR(IM) -> LAVR(IM) -> LAVR(OM) (3,7)
C  MRDVR -> MRAVR (8)
C
        DO 100 IVR=1,2
        DO 100 ISEG=1,2
        CHOP=RCHOP(IVR,ISEG)
        CALL RDSEG(*92,*190)
   92   CONTINUE
C
C LUMINAL VARIABLES
	DO 96 IX = 1,CHOP+1
C	RDIST(IVR,ISEG,IX) = DIST(IX)
C ALLOW FOLDED VESSEL
        IF (ISEG.EQ.1) THEN
	RDIST(IVR,ISEG,IX) = DIST(IX)
        ELSE IF (ISEG.EQ.2) THEN
       	RDIST(IVR,ISEG,IX) = RDIST(IVR,1,CHOP+2-IX)
        ENDIF
	RVC(IVR,ISEG,IX) = VC(IX)
	RPC(IVR,ISEG,IX) = PC(IX)
	RIMPC(IVR,ISEG,IX) = IMPC(IX)
	RLCHC(IVR,ISEG,IX) = LCHC(IX)
	ROSMC(IVR,ISEG,IX) = OSMC(IX)
	RTA(IVR,ISEG,IX) = TA(IX)/1.D3
	RFVC(IVR,ISEG,IX) = FVC(IX)
	DO 95 ISOL = 1,SOLS
	RCC(IVR,ISEG,ISOL,IX) = CC(ISOL,IX)
	RXC(IVR,ISEG,ISOL,IX) = XC(ISOL,IX)
	RFKC(IVR,ISEG,ISOL,IX) = FKC(ISOL,IX)
   95   CONTINUE
	RFKC(IVR,ISEG,16,IX) = FKC(16,IX)
	RFKC(IVR,ISEG,17,IX) = FKC(17,IX)
        NAE(IX) = CC(11,IX)-CC(4,IX)+TA(IX)/1.D3 
        FKC(18,IX) = FKC(11,IX)-FKC(4,IX)+FKC(17,IX)
        RNAE(IVR,ISEG,IX)=NAE(IX)
        RFKC(IVR,ISEG,18,IX)=FKC(18,IX)
   96   CONTINUE
  100   CONTINUE
C
C
        DO 120 IVR=3,7
        DO 120 ISEG=1,4
        CHOP=RCHOP(IVR,ISEG)
        CALL RDSEG(*112,*190)
  112   CONTINUE
C
C LUMINAL VARIABLES
	DO 116 IX = 1,CHOP+1
C        IF (ISEG.LE.2) THEN
C	RDIST(IVR,ISEG,IX) = DIST(IX)
C        ELSE
C	RDIST(IVR,ISEG,IX) = DIST(IX) + 0.2*FLOAT(7-IVR)
C        ENDIF
        IF (ISEG.LE.2) THEN
        RDIST(IVR,ISEG,IX) = DIST(IX)
        ELSE IF (ISEG.EQ.3) THEN
        RDIST(IVR,ISEG,IX) = RDIST(IVR,2,CHOP+2-IX)
        ELSE IF (ISEG.EQ.4) THEN
        RDIST(IVR,ISEG,IX) = RDIST(IVR,1,CHOP+2-IX)
        ENDIF
	RVC(IVR,ISEG,IX) = VC(IX)
	RPC(IVR,ISEG,IX) = PC(IX)
	RIMPC(IVR,ISEG,IX) = IMPC(IX)
	RLCHC(IVR,ISEG,IX) = LCHC(IX)
	ROSMC(IVR,ISEG,IX) = OSMC(IX)
	RTA(IVR,ISEG,IX) = TA(IX)/1.D3
	RFVC(IVR,ISEG,IX) = FVC(IX)
	DO 115 ISOL = 1,SOLS
	RCC(IVR,ISEG,ISOL,IX) = CC(ISOL,IX)
	RXC(IVR,ISEG,ISOL,IX) = XC(ISOL,IX)
	RFKC(IVR,ISEG,ISOL,IX) = FKC(ISOL,IX)
  115   CONTINUE
	RFKC(IVR,ISEG,16,IX) = FKC(16,IX)
	RFKC(IVR,ISEG,17,IX) = FKC(17,IX)
        NAE(IX) = CC(11,IX)-CC(4,IX)+TA(IX)/1.D3 
        FKC(18,IX) = FKC(11,IX)-FKC(4,IX)+FKC(17,IX)
        RNAE(IVR,ISEG,IX)=NAE(IX)
        RFKC(IVR,ISEG,18,IX)=FKC(18,IX)
  116   CONTINUE
  120   CONTINUE
C
        IVR=8
        DO 130 ISEG=1,2
        CHOP=RCHOP(IVR,ISEG)
        CALL RDSEG(*122,*190)
  122   CONTINUE
C
C LUMINAL VARIABLES
	DO 126 IX = 1,CHOP+1
C	RDIST(IVR,ISEG,IX) = DIST(IX)
C ALLOW FOLDED VESSEL
        IF (ISEG.EQ.1) THEN
	RDIST(IVR,ISEG,IX) = DIST(IX)
        ELSE IF (ISEG.EQ.2) THEN
       	RDIST(IVR,ISEG,IX) = RDIST(IVR,1,CHOP+2-IX)
        ENDIF
	RVC(IVR,ISEG,IX) = VC(IX)
	RPC(IVR,ISEG,IX) = PC(IX)
	RIMPC(IVR,ISEG,IX) = IMPC(IX)
	RLCHC(IVR,ISEG,IX) = LCHC(IX)
	ROSMC(IVR,ISEG,IX) = OSMC(IX)
	RTA(IVR,ISEG,IX) = TA(IX)
	RFVC(IVR,ISEG,IX) = FVC(IX)
	DO 125 ISOL = 1,SOLS
	RCC(IVR,ISEG,ISOL,IX) = CC(ISOL,IX)
	RXC(IVR,ISEG,ISOL,IX) = XC(ISOL,IX)
	RFKC(IVR,ISEG,ISOL,IX) = FKC(ISOL,IX)
  125   CONTINUE
	RFKC(IVR,ISEG,16,IX) = FKC(16,IX)
	RFKC(IVR,ISEG,17,IX) = FKC(17,IX)
        NAE(IX) = CC(11,IX)-CC(4,IX)+TA(IX)/1.D3 
        FKC(18,IX) = FKC(11,IX)-FKC(4,IX)+FKC(17,IX)
        RNAE(IVR,ISEG,IX)=NAE(IX)
        RFKC(IVR,ISEG,18,IX)=FKC(18,IX)
  126   CONTINUE
  130   CONTINUE
C
C ALLOW FOR THE POSSIBILITY FOR OUTPUT OF TOTAL FLOWS FROM 
C    SDVR (IVR=1,2) -> IVR=9, AND LDVR (IVR=3,7) -> IVR=10
C
C LONG AVR
C
        ISEG=1
        CHOP=RCHOP(7,ISEG)
        DO 150 IX=1,CHOP+1
        ROSMC(10,ISEG,IX)=ROSMC(7,ISEG,IX)*RFVC(7,ISEG,IX)
        RFVC(10,ISEG,IX)=RFVC(7,ISEG,IX)
        DO 148 IVR=3,6
        ROSMC(10,ISEG,IX)=ROSMC(10,ISEG,IX)+
     1    ROSMC(IVR,ISEG,IX)*RFVC(IVR,ISEG,IX)
  148   RFVC(10,ISEG,IX)=RFVC(10,ISEG,IX)+RFVC(IVR,ISEG,IX)
        ROSMC(10,ISEG,IX)=ROSMC(10,ISEG,IX)/RFVC(10,ISEG,IX)
        DO 149 ISOL=1,18
        RFKC(10,ISEG,ISOL,IX)=RFKC(7,ISEG,ISOL,IX)
        DO 149 IVR=3,6
  149   RFKC(10,ISEG,ISOL,IX)=
     1   RFKC(10,ISEG,ISOL,IX)+RFKC(IVR,ISEG,ISOL,IX)
  150   CONTINUE
C
        ISEG=4
        CHOP=RCHOP(7,ISEG)
        DO 160 IX=1,CHOP+1
        ROSMC(10,ISEG,IX)=ROSMC(7,ISEG,IX)*RFVC(7,ISEG,IX)
        RFVC(10,ISEG,IX)=RFVC(7,ISEG,IX)
        DO 158 IVR=3,6
        ROSMC(10,ISEG,IX)=ROSMC(10,ISEG,IX)+
     1    ROSMC(IVR,ISEG,IX)*RFVC(IVR,ISEG,IX)
  158   RFVC(10,ISEG,IX)=RFVC(10,ISEG,IX)+RFVC(IVR,ISEG,IX)
        ROSMC(10,ISEG,IX)=ROSMC(10,ISEG,IX)/RFVC(10,ISEG,IX)
        DO 159 ISOL=1,18
        RFKC(10,ISEG,ISOL,IX)=RFKC(7,ISEG,ISOL,IX)
        DO 159 IVR=3,6
  159   RFKC(10,ISEG,ISOL,IX)=
     1   RFKC(10,ISEG,ISOL,IX)+RFKC(IVR,ISEG,ISOL,IX)
  160   CONTINUE
C
        ISEG=2
        CHOP=RCHOP(7,ISEG)
        DO 165 IX=1,CHOP+1
        ROSMC(10,ISEG,IX)=ROSMC(7,ISEG,IX)*RFVC(7,ISEG,IX)
        RFVC(10,ISEG,IX)=RFVC(7,ISEG,IX)
        DO 165 ISOL=1,18
        RFKC(10,ISEG,ISOL,IX)=RFKC(7,ISEG,ISOL,IX)
  165   CONTINUE
        DO 170 IVR=6,3,-1
        CHOP=RCHOP(IVR,ISEG)
        DO 170 IX=1,CHOP+1
        ROSMC(10,ISEG,IX)=ROSMC(10,ISEG,IX)+
     1    ROSMC(IVR,ISEG,IX)*RFVC(IVR,ISEG,IX)
        RFVC(10,ISEG,IX)=RFVC(10,ISEG,IX)+RFVC(IVR,ISEG,IX)
        DO 169 ISOL=1,18
        RFKC(10,ISEG,ISOL,IX)=
     1   RFKC(10,ISEG,ISOL,IX)+RFKC(IVR,ISEG,ISOL,IX)
  169   CONTINUE
  170   CONTINUE
        CHOP=RCHOP(7,ISEG)
        DO 171 IX=1,CHOP+1
        ROSMC(10,ISEG,IX)=ROSMC(10,ISEG,IX)/RFVC(10,ISEG,IX)
  171   CONTINUE
C
        ISEG=3
        CHOP=RCHOP(7,ISEG)
        ICHOP7=CHOP
        DO 175 IX=1,CHOP+1
        ROSMC(10,ISEG,IX)=ROSMC(7,ISEG,IX)*RFVC(7,ISEG,IX)
        RFVC(10,ISEG,IX)=RFVC(7,ISEG,IX)
        DO 175 ISOL=1,18
        RFKC(10,ISEG,ISOL,IX)=RFKC(7,ISEG,ISOL,IX)
  175   CONTINUE
        DO 180 IVR=6,3,-1
        CHOP=RCHOP(IVR,ISEG)
        DO 180 IX=1,CHOP+1
        ROSMC(10,ISEG,IX)=ROSMC(10,ISEG,IX)+
     1    ROSMC(IVR,ISEG,IX)*RFVC(IVR,ISEG,IX)
        RFVC(10,ISEG,ICHOP7-CHOP+IX)=
     1    RFVC(10,ISEG,ICHOP7-CHOP+IX)+RFVC(IVR,ISEG,IX)
        DO 179 ISOL=1,18
        RFKC(10,ISEG,ISOL,ICHOP7-CHOP+IX)=
     1   RFKC(10,ISEG,ISOL,ICHOP7-CHOP+IX)+RFKC(IVR,ISEG,ISOL,IX)
  179   CONTINUE
  180   CONTINUE
        CHOP=RCHOP(7,ISEG)
        DO 181 IX=1,CHOP+1
        ROSMC(10,ISEG,IX)=ROSMC(10,ISEG,IX)/RFVC(10,ISEG,IX)
  181   CONTINUE
C
C SHORT AVR
C
        ISEG=1
        CHOP=RCHOP(2,ISEG)
        DO 163 IX=1,CHOP+1
        ROSMC(9,ISEG,IX)=ROSMC(2,ISEG,IX)*RFVC(2,ISEG,IX)
        RFVC(9,ISEG,IX)=RFVC(2,ISEG,IX)
        DO 163 ISOL=1,18
        RFKC(9,ISEG,ISOL,IX)=RFKC(2,ISEG,ISOL,IX)
  163   CONTINUE
        IVR=1
        CHOP=RCHOP(IVR,ISEG)
        DO 168 IX=1,CHOP+1
        ROSMC(9,ISEG,IX)=ROSMC(9,ISEG,IX)+
     1    ROSMC(IVR,ISEG,IX)*RFVC(IVR,ISEG,IX)
        RFVC(9,ISEG,IX)=RFVC(9,ISEG,IX)+RFVC(IVR,ISEG,IX)
        DO 167 ISOL=1,18
        RFKC(9,ISEG,ISOL,IX)=
     1   RFKC(9,ISEG,ISOL,IX)+RFKC(IVR,ISEG,ISOL,IX)
  167   CONTINUE
  168   CONTINUE
        CHOP=RCHOP(2,ISEG)
        DO 172 IX=1,CHOP+1
        ROSMC(9,ISEG,IX)=ROSMC(9,ISEG,IX)/RFVC(9,ISEG,IX)
  172   CONTINUE
C
        ISEG=2
        CHOP=RCHOP(2,ISEG)
        ICHOP2=CHOP
        DO 173 IX=1,CHOP+1
        ROSMC(9,ISEG,IX)=ROSMC(2,ISEG,IX)*RFVC(2,ISEG,IX)
        RFVC(9,ISEG,IX)=RFVC(2,ISEG,IX)
        DO 173 ISOL=1,18
        RFKC(9,ISEG,ISOL,IX)=RFKC(2,ISEG,ISOL,IX)
  173   CONTINUE
        IVR=1
        CHOP=RCHOP(IVR,ISEG)
        DO 178 IX=1,CHOP+1
        ROSMC(9,ISEG,IX)=ROSMC(9,ISEG,IX)+
     1    ROSMC(IVR,ISEG,IX)*RFVC(IVR,ISEG,IX)
        RFVC(9,ISEG,ICHOP2-CHOP+IX)=
     1    RFVC(9,ISEG,ICHOP2-CHOP+IX)+RFVC(IVR,ISEG,IX)
        DO 177 ISOL=1,18
        RFKC(9,ISEG,ISOL,ICHOP2-CHOP+IX)=
     1   RFKC(9,ISEG,ISOL,ICHOP2-CHOP+IX)+RFKC(IVR,ISEG,ISOL,IX)
  177   CONTINUE
  178   CONTINUE
        CHOP=RCHOP(2,ISEG)
        DO 182 IX=1,CHOP+1
        ROSMC(9,ISEG,IX)=ROSMC(9,ISEG,IX)/RFVC(9,ISEG,IX)
  182   CONTINUE
C
        GO TO 199
C
  190   PRINT 192, IVR,ISEG
  192   FORMAT ('PREMATURE EOF:',2X,'IVR= ', I2, 10X,'ISEG= ',I2)
        STOP
C
C ALL VARIABLES HAVE BEEN READ INTO THE ARCHIVE
C THE SELECTED VARIABLES SHOULD BE PRINTED INTO A FILE READABLE BY GRX:
C   SEGMENT BY SEGMENT EACH VARIABLE IS PRINTED
C FIRST A SURROGATE LUMEN.DAT PAGE IS CREATED:
C        DIST   VC    PC     CC    IMPC   TA   LCHC    XC     OSMC    FVC     FKC     
C COL:    1     2     3     4-18    19    20    21    22-36    37     38     39-56
C
C One optional output file may be generated, along with the standard output files.
C
  199   DO 300 KK=1,7
        IUNIT=19+KK
        JUNIT=29+KK
        NWR=2
        SCAL(1)=1.D1
        SCAL(2)=1.D3
        SCAL(3)=6.D1
        IF (IUNIT.EQ.20) THEN
        VNAME1(2) = 'cc'
        VNAME2(2) = 'na'
        VNAME1(3) = 'fkc'
        VNAME2(3) = 'na'
        BARNAM(KK)=VNAME2(3)
        ELSE IF (IUNIT.EQ.21) THEN
        VNAME1(2) = 'cc'
        VNAME2(2) = 'k'
        VNAME1(3) = 'fkc'
        VNAME2(3) = 'k'
        BARNAM(KK)=VNAME2(3)
        ELSE IF (IUNIT.EQ.22) THEN
        VNAME1(2) = 'cc'
        VNAME2(2) = 'hco3'
        VNAME1(3) = 'fkc'
        VNAME2(3) = 'hco3'
        BARNAM(KK)=VNAME2(3)
        ELSE IF (IUNIT.EQ.23) THEN
        VNAME1(2) = 'cc'
        VNAME2(2) = 'nh4'
        VNAME1(3) = 'fkc'
        VNAME2(3) = 'nh4'
        BARNAM(KK)=VNAME2(3)
        ELSE IF (IUNIT.EQ.24) THEN
        VNAME1(2) = 'nae'
        VNAME1(3) = 'fkc'
        VNAME2(3) = 'nae'
        BARNAM(KK)=VNAME2(3)
        ELSE IF (IUNIT.EQ.25) THEN
        VNAME1(2) = 'cc'
        VNAME2(2) = 'urea'
        VNAME1(3) = 'fkc'
        VNAME2(3) = 'urea'
        BARNAM(KK)=VNAME2(3)
        ELSE IF (IUNIT.EQ.26) THEN
        VNAME1(2) = 'osmc'
        VNAME1(3) = 'fvc'
        BARNAM(KK)=VNAME1(3)
        ENDIF
C
        JWR(1)=1
        DO 197 KWR=2,NWR+1
  197   CALL SELEC (VNAME1(KWR),VNAME2(KWR),JWR(KWR))
C
  200   CONTINUE
C
C FULL OUTPUT OF ALL VASCULAR SEGMENTS:  SAVR
C
        DO 201 ISEG=1,2
        WRDL(9,ISEG,KK)=0.D0
        WREX(9,ISEG,KK)=0.D0
        WRRES(9,ISEG,KK)=0.D0
  201   CONTINUE
C
        DO 220 IVR=1,2
        DO 220 ISEG=1,2
        CHOP=RCHOP(IVR,ISEG)
        DCHOP=RDCHOP(IVR,ISEG)
        DO 204 IX=1,CHOP+1
        RDPAGE(1,IX)=RDIST(IVR,ISEG,IX)
        RDPAGE(2,IX)=RVC(IVR,ISEG,IX)
        RDPAGE(3,IX)=RPC(IVR,ISEG,IX)
        RDPAGE(19,IX)=RIMPC(IVR,ISEG,IX)
        RDPAGE(20,IX)=RTA(IVR,ISEG,IX)
        RDPAGE(21,IX)=RLCHC(IVR,ISEG,IX)
        RDPAGE(37,IX)=ROSMC(IVR,ISEG,IX)
        RDPAGE(38,IX)=RFVC(IVR,ISEG,IX)
        RDPAGE(54,IX)=RFKC(IVR,ISEG,16,IX)
        RDPAGE(55,IX)=RFKC(IVR,ISEG,17,IX)
        RDPAGE(56,IX)=RFKC(IVR,ISEG,18,IX)
        RDPAGE(57,IX)=RNAE(IVR,ISEG,IX)
        DO 202 ISOL=1,15
        RDPAGE(3+ISOL,IX)=RCC(IVR,ISEG,ISOL,IX)
        RDPAGE(21+ISOL,IX)=RXC(IVR,ISEG,ISOL,IX)
        RDPAGE(38+ISOL,IX)=RFKC(IVR,ISEG,ISOL,IX)
  202   CONTINUE
  204   CONTINUE
        DO 208 IX=1,CHOP+1
        DO 206 KWR=1,NWR+1
  206   WRPAGE(KWR,IX)=RDPAGE(JWR(KWR),IX)
  208   CONTINUE
C
        WRDL(IVR,ISEG,KK)=WRPAGE(3,1)
        WREX(IVR,ISEG,KK)=WRPAGE(3,CHOP+1)
        WRRES(IVR,ISEG,KK)=WRDL(IVR,ISEG,KK)-WREX(IVR,ISEG,KK)
C
        WRDL(9,ISEG,KK)=WRDL(9,ISEG,KK) + WRDL(IVR,ISEG,KK)
        WREX(9,ISEG,KK)=WREX(9,ISEG,KK) + WREX(IVR,ISEG,KK)
        WRRES(9,ISEG,KK)=WRRES(9,ISEG,KK) + WRRES(IVR,ISEG,KK)
C
        IF (IVR.EQ.2) THEN
        WRITE(IUNIT,298) 1+(CHOP/DCHOP)
  298   FORMAT(I3)
        DO 210 IX=1,CHOP+1,DCHOP
  210   WRITE(IUNIT,299) (SCAL(KWR)*WRPAGE(KWR,IX),KWR=1,NWR+1)
  299   FORMAT (8D16.8)
        ELSE
        ENDIF
  220   CONTINUE
C
C FULL OUTPUT OF ALL VASCULAR SEGMENTS:  LAVR
C
        DO 241 ISEG=1,4
        WRDL(10,ISEG,KK)=0.D0
        WREX(10,ISEG,KK)=0.D0
        WRRES(10,ISEG,KK)=0.D0
  241   CONTINUE
C
        DO 260 IVR=3,7
        DO 260 ISEG=1,4
        CHOP=RCHOP(IVR,ISEG)
        DCHOP=RDCHOP(IVR,ISEG)
        DO 244 IX=1,CHOP+1
        RDPAGE(1,IX)=RDIST(IVR,ISEG,IX)
        RDPAGE(2,IX)=RVC(IVR,ISEG,IX)
        RDPAGE(3,IX)=RPC(IVR,ISEG,IX)
        RDPAGE(19,IX)=RIMPC(IVR,ISEG,IX)
        RDPAGE(20,IX)=RTA(IVR,ISEG,IX)
        RDPAGE(21,IX)=RLCHC(IVR,ISEG,IX)
        RDPAGE(37,IX)=ROSMC(IVR,ISEG,IX)
        RDPAGE(38,IX)=RFVC(IVR,ISEG,IX)
        RDPAGE(54,IX)=RFKC(IVR,ISEG,16,IX)
        RDPAGE(55,IX)=RFKC(IVR,ISEG,17,IX)
        RDPAGE(56,IX)=RFKC(IVR,ISEG,18,IX)
        RDPAGE(57,IX)=RNAE(IVR,ISEG,IX)
        DO 242 ISOL=1,15
        RDPAGE(3+ISOL,IX)=RCC(IVR,ISEG,ISOL,IX)
        RDPAGE(21+ISOL,IX)=RXC(IVR,ISEG,ISOL,IX)
        RDPAGE(38+ISOL,IX)=RFKC(IVR,ISEG,ISOL,IX)
  242   CONTINUE
  244   CONTINUE
        DO 248 IX=1,CHOP+1
        DO 246 KWR=1,NWR+1
  246   WRPAGE(KWR,IX)=RDPAGE(JWR(KWR),IX)
  248   CONTINUE
C
        WRDL(IVR,ISEG,KK)=WRPAGE(3,1)
        WREX(IVR,ISEG,KK)=WRPAGE(3,CHOP+1)
        WRRES(IVR,ISEG,KK)=WRDL(IVR,ISEG,KK)-WREX(IVR,ISEG,KK)
C
        WRDL(10,ISEG,KK)=WRDL(10,ISEG,KK) + WRDL(IVR,ISEG,KK)
        WREX(10,ISEG,KK)=WREX(10,ISEG,KK) + WREX(IVR,ISEG,KK)
        WRRES(10,ISEG,KK)=WRRES(10,ISEG,KK) + WRRES(IVR,ISEG,KK)
C
        IF (IVR.EQ.7) THEN
        WRITE(IUNIT,298) 1+(CHOP/DCHOP)
        DO 250 IX=1,CHOP+1,DCHOP
  250   WRITE(IUNIT,299) (SCAL(KWR)*WRPAGE(KWR,IX),KWR=1,NWR+1)
        ELSE
        ENDIF
  260   CONTINUE
C
C FULL OUTPUT OF ALL VASCULAR SEGMENTS:  MR
C
        IVR=8
        DO 230 ISEG=1,2
        CHOP=RCHOP(IVR,ISEG)
        DCHOP=RDCHOP(IVR,ISEG)
        DO 234 IX=1,CHOP+1
        RDPAGE(1,IX)=RDIST(IVR,ISEG,IX)
        RDPAGE(2,IX)=RVC(IVR,ISEG,IX)
        RDPAGE(3,IX)=RPC(IVR,ISEG,IX)
        RDPAGE(19,IX)=RIMPC(IVR,ISEG,IX)
        RDPAGE(20,IX)=RTA(IVR,ISEG,IX)
        RDPAGE(21,IX)=RLCHC(IVR,ISEG,IX)
        RDPAGE(37,IX)=ROSMC(IVR,ISEG,IX)
        RDPAGE(38,IX)=RFVC(IVR,ISEG,IX)
        RDPAGE(54,IX)=RFKC(IVR,ISEG,16,IX)
        RDPAGE(55,IX)=RFKC(IVR,ISEG,17,IX)
        RDPAGE(56,IX)=RFKC(IVR,ISEG,18,IX)
        RDPAGE(57,IX)=RNAE(IVR,ISEG,IX)
        DO 232 ISOL=1,15
        RDPAGE(3+ISOL,IX)=RCC(IVR,ISEG,ISOL,IX)
        RDPAGE(21+ISOL,IX)=RXC(IVR,ISEG,ISOL,IX)
        RDPAGE(38+ISOL,IX)=RFKC(IVR,ISEG,ISOL,IX)
  232   CONTINUE
  234   CONTINUE
        DO 238 IX=1,CHOP+1
        DO 236 KWR=1,NWR+1
  236   WRPAGE(KWR,IX)=RDPAGE(JWR(KWR),IX)
  238   CONTINUE
C
        WRDL(IVR,ISEG,KK)=WRPAGE(3,1)
        WREX(IVR,ISEG,KK)=WRPAGE(3,CHOP+1)
        WRRES(IVR,ISEG,KK)=WRDL(IVR,ISEG,KK)-WREX(IVR,ISEG,KK)
C
        GO TO 240
        WRITE(IUNIT,298) 1+(CHOP/DCHOP)
        DO 239 IX=1,CHOP+1,DCHOP
  239   WRITE(IUNIT,299) (SCAL(KWR)*WRPAGE(KWR,IX),KWR=1,NWR+1)
  240   CONTINUE
  230   CONTINUE
C
C
C Bargraph data for composite SAVR and LAVR and then MR
C
	NBARS=10
	WRITE (JUNIT,965) NBARS
	WRITE (JUNIT,965) 0, SCAL(3)*WRDL(9,1,KK),1
	WRITE (JUNIT,965) 0, SCAL(3)*WRDL(10,1,KK),2
        WRITE (JUNIT,965) 1, -SCAL(3)*WRRES(9,1,KK),1
        WRITE (JUNIT,965) 1, -SCAL(3)*WRRES(10,1,KK),2
        WRITE (JUNIT,965) 2, -SCAL(3)*WRRES(10,2,KK),2
        WRITE (JUNIT,965) 3, -SCAL(3)*WRRES(10,3,KK),2
        WRITE (JUNIT,965) 4, -SCAL(3)*WRRES(9,2,KK),1
        WRITE (JUNIT,965) 4, -SCAL(3)*WRRES(10,4,KK),2
        WRITE (JUNIT,965) 5, SCAL(3)*WREX(9,2,KK),1
        WRITE (JUNIT,965) 5, SCAL(3)*WREX(10,4,KK),2
C
        GO TO 970
	NBARS=4
	WRITE (JUNIT,965) NBARS
	WRITE (JUNIT,965) 0, SCAL(3)*WRDL(8,1,KK),3
        WRITE (JUNIT,965) 1, -SCAL(3)*WRRES(8,1,KK),3
        WRITE (JUNIT,965) 2, -SCAL(3)*WRRES(8,2,KK),3
	WRITE (JUNIT,965) 2, SCAL(3)*WREX(8,2,KK),3
  965   FORMAT (I2,F9.3,2X,I2)
  970   CONTINUE
C
  300   CONTINUE
C
C Output tabular data
C
        DO 920 IVR=1,2
	WRITE (40,902) VRNAM(IVR),
     1   (SEGOM(ISEG),ISEG=1,2)
  902   FORMAT(///,2X,A5,3X,13(A5,7X))
	WRITE (40,903) 
  903   FORMAT(/,2X,'absolute delivery',/)
	DO 923 KK=1,7
  923   WRITE (40,915) BARNAM(KK),
     1    (WRDL(IVR,ISEG,KK),ISEG=1,2),
     1    WREX(IVR,2,KK)
	WRITE (40,904) 
  904   FORMAT(/,2X,'absolute reabsorption',/)
	DO 924 KK=1,7
  924   WRITE (40,915) BARNAM(KK),
     1    (WRRES(IVR,ISEG,KK),ISEG=1,2),
     1    WRDL(IVR,1,KK)-WREX(IVR,2,KK)
	WRITE (40,905) 
  905   FORMAT(/,2X,'reabsorption relative to segmental delivery',/)
	DO 925 KK=1,7
  925   WRITE (40,916) BARNAM(KK),
     1    (WRRES(IVR,ISEG,KK)/WRDL(IVR,ISEG,KK),ISEG=1,2),
     1    (WRDL(IVR,1,KK)-WREX(IVR,2,KK))/WRDL(IVR,1,KK)
	WRITE (40,906) 
  906   FORMAT(/,2X,'reabsorption relative to initial delivery',/)
	DO 926 KK=1,7
  926   WRITE (40,916) BARNAM(KK),
     1    (WRRES(IVR,ISEG,KK)/WRDL(IVR,1,KK),ISEG=1,2),
     1    (WRDL(IVR,1,KK)-WREX(IVR,2,KK))/WRDL(IVR,1,KK)
  915   FORMAT (1X,A5,13E12.4)
  916   FORMAT (1X,A5,13F12.4)
  920   CONTINUE
C
        IVR=9
	WRITE (40,902) VRNAM(IVR),
     1   (SEGOM(ISEG),ISEG=1,2)
	WRITE (40,903) 
	DO 922 KK=1,7
  922   WRITE (40,915) BARNAM(KK),
     1    (WRDL(IVR,ISEG,KK),ISEG=1,2),
     1    WREX(IVR,2,KK)
	WRITE (40,904) 
	DO 927 KK=1,7
  927   WRITE (40,915) BARNAM(KK),
     1    (WRRES(IVR,ISEG,KK),ISEG=1,2),
     1    WRDL(IVR,1,KK)-WREX(IVR,2,KK)
	WRITE (40,905) 
	DO 928 KK=1,7
  928   WRITE (40,916) BARNAM(KK),
     1    (WRRES(IVR,ISEG,KK)/WRDL(IVR,ISEG,KK),ISEG=1,2),
     1    (WRDL(IVR,1,KK)-WREX(IVR,2,KK))/WRDL(IVR,1,KK)
	WRITE (40,906) 
	DO 929 KK=1,7
  929   WRITE (40,916) BARNAM(KK),
     1    (WRRES(IVR,ISEG,KK)/WRDL(IVR,1,KK),ISEG=1,2),
     1    (WRDL(IVR,1,KK)-WREX(IVR,2,KK))/WRDL(IVR,1,KK)
C
        DO 940 IVR=3,7
	WRITE (40,902) VRNAM(IVR),
     1   (SEGIM(ISEG),ISEG=1,4)
	WRITE (40,903) 
	DO 933 KK=1,7
  933   WRITE (40,915) BARNAM(KK),
     1    (WRDL(IVR,ISEG,KK),ISEG=1,4),
     1    WREX(IVR,4,KK)
	WRITE (40,904) 
	DO 934 KK=1,7
  934   WRITE (40,915) BARNAM(KK),
     1    (WRRES(IVR,ISEG,KK),ISEG=1,4),
     1    WRDL(IVR,1,KK)-WREX(IVR,4,KK)
	WRITE (40,905) 
	DO 935 KK=1,7
  935   WRITE (40,916) BARNAM(KK),
     1    (WRRES(IVR,ISEG,KK)/WRDL(IVR,ISEG,KK),ISEG=1,4),
     1    (WRDL(IVR,1,KK)-WREX(IVR,4,KK))/WRDL(IVR,1,KK)
	WRITE (40,906) 
	DO 936 KK=1,7
  936   WRITE (40,916) BARNAM(KK),
     1    (WRRES(IVR,ISEG,KK)/WRDL(IVR,1,KK),ISEG=1,4),
     1    (WRDL(IVR,1,KK)-WREX(IVR,4,KK))/WRDL(IVR,1,KK)
  940   CONTINUE
C
        IVR=10
	WRITE (40,902) VRNAM(IVR),
     1   (SEGIM(ISEG),ISEG=1,4)
	WRITE (40,903) 
	DO 932 KK=1,7
  932   WRITE (40,915) BARNAM(KK),
     1    (WRDL(IVR,ISEG,KK),ISEG=1,4),
     1    WREX(IVR,4,KK)
	WRITE (40,904) 
	DO 937 KK=1,7
  937   WRITE (40,915) BARNAM(KK),
     1    (WRRES(IVR,ISEG,KK),ISEG=1,4),
     1    WRDL(IVR,1,KK)-WREX(IVR,4,KK)
	WRITE (40,905) 
	DO 938 KK=1,7
  938   WRITE (40,916) BARNAM(KK),
     1    (WRRES(IVR,ISEG,KK)/WRDL(IVR,ISEG,KK),ISEG=1,4),
     1    (WRDL(IVR,1,KK)-WREX(IVR,4,KK))/WRDL(IVR,1,KK)
	WRITE (40,906) 
	DO 939 KK=1,7
  939   WRITE (40,916) BARNAM(KK),
     1    (WRRES(IVR,ISEG,KK)/WRDL(IVR,1,KK),ISEG=1,4),
     1    (WRDL(IVR,1,KK)-WREX(IVR,4,KK))/WRDL(IVR,1,KK)
C
        IVR=8
	WRITE (40,902) VRNAM(IVR),
     1   (SEGOM(ISEG),ISEG=1,2)
	WRITE (40,903) 
	DO 942 KK=1,7
  942   WRITE (40,915) BARNAM(KK),
     1    (WRDL(IVR,ISEG,KK),ISEG=1,2),
     1    WREX(IVR,2,KK)
	WRITE (40,904) 
	DO 947 KK=1,7
  947   WRITE (40,915) BARNAM(KK),
     1    (WRRES(IVR,ISEG,KK),ISEG=1,2),
     1    WRDL(IVR,1,KK)-WREX(IVR,2,KK)
	WRITE (40,905) 
	DO 948 KK=1,7
  948   WRITE (40,916) BARNAM(KK),
     1    (WRRES(IVR,ISEG,KK)/WRDL(IVR,ISEG,KK),ISEG=1,2),
     1    (WRDL(IVR,1,KK)-WREX(IVR,2,KK))/WRDL(IVR,1,KK)
	WRITE (40,906) 
	DO 949 KK=1,7
  949   WRITE (40,916) BARNAM(KK),
     1    (WRRES(IVR,ISEG,KK)/WRDL(IVR,1,KK),ISEG=1,2),
     1    (WRDL(IVR,1,KK)-WREX(IVR,2,KK))/WRDL(IVR,1,KK)
C
        write (40,950)
  950   format (//,5x,'net excretion OM+IM')
        do 955 kk=1,7
  955   write (40,916) barnam(kk),
     1    (wrex(9,2,kk)-wrdl(9,1,kk))+(wrex(10,4,kk)-wrdl(10,1,kk))
C
        PRINT 2
    2   FORMAT (' DO YOU NEED A CUSTOM OUTPUT FILE? (y,n): ',$)
        READ 30, SWO
        IF (SWO.EQ.'n') GO TO 400
        IUNIT=2
    4   FORMAT(A12)
	PRINT 6
    6   FORMAT(' TYPE THE OUTPUT FILENAME:',$)
	READ 4, OPTFIL
	OPEN(IUNIT,FILE=OPTFIL)
C
	PRINT 10
   10   FORMAT(' IS INPUT FROM A DATA FILE OR INTERACTIVE? (d/i): ',$)
	READ 30, SWI
        IF (SWI.EQ.'i') GO TO 15
	PRINT 11
   11   FORMAT(' TYPE THE VARIABLE FILENAME:',$)
	READ 4, VARNAM
	OPEN(4,FILE=VARNAM)
	READ (4,12) NWR
   12   FORMAT(3X,I2)
	DO 13 KWR=2,NWR+1
   13   READ (4,14) VNAME1(KWR),VNAME2(KWR)
   14   FORMAT(2A5)
	GO TO 55
C
   15   PRINT 16
   16   FORMAT(' TYPE THE NUMBER OF VARIABLES TO BE REWRITTEN')
	READ *, NWR
	DO 50 KWR=2,NWR+1
	PRINT 20, KWR-1
   20   FORMAT(' TYPE THE NAME OF VARIABLE NUMBER-',I2)
	READ 30, VNAME1(KWR)
   30   FORMAT(A5)
	IF(VNAME1(KWR).EQ.'cc') THEN
        SCAL(KWR)=1.D3
        GO TO 40
	ELSE IF(VNAME1(KWR).EQ.'xc') THEN
        SCAL(KWR)=1.D0
        GO TO 40
	ELSE IF(VNAME1(KWR).EQ.'fkc') THEN
        SCAL(KWR)=6.D1
        GO TO 40
        ELSE
        SCAL(KWR)=1.D0
        ENDIF
	GO TO 50
C
   40   PRINT 45
   45   FORMAT(' TYPE THE SPECIES')
	READ 30, VNAME2(KWR)
   50   CONTINUE
C
   55   JWR(1)=1
        DO 57 KWR=2,NWR+1
   57   CALL SELEC (VNAME1(KWR),VNAME2(KWR),JWR(KWR))
C   
        IVR=2
        DO 320 ISEG=1,2
        CHOP=RCHOP(IVR,ISEG)
        DCHOP=RDCHOP(IVR,ISEG)
        DO 304 IX=1,CHOP+1
        RDPAGE(1,IX)=RDIST(IVR,ISEG,IX)
        RDPAGE(2,IX)=RVC(IVR,ISEG,IX)
        RDPAGE(3,IX)=RPC(IVR,ISEG,IX)
        RDPAGE(19,IX)=RIMPC(IVR,ISEG,IX)
        RDPAGE(20,IX)=RTA(IVR,ISEG,IX)
        RDPAGE(21,IX)=RLCHC(IVR,ISEG,IX)
        RDPAGE(37,IX)=ROSMC(IVR,ISEG,IX)
        RDPAGE(38,IX)=RFVC(IVR,ISEG,IX)
        RDPAGE(54,IX)=RFKC(IVR,ISEG,16,IX)
        RDPAGE(55,IX)=RFKC(IVR,ISEG,17,IX)
        RDPAGE(56,IX)=RFKC(IVR,ISEG,18,IX)
        RDPAGE(57,IX)=RNAE(IVR,ISEG,IX)
        DO 302 ISOL=1,15
        RDPAGE(3+ISOL,IX)=RCC(IVR,ISEG,ISOL,IX)
        RDPAGE(21+ISOL,IX)=RXC(IVR,ISEG,ISOL,IX)
        RDPAGE(38+ISOL,IX)=RFKC(IVR,ISEG,ISOL,IX)
  302   CONTINUE
  304   CONTINUE
        DO 308 IX=1,CHOP+1
        DO 306 KWR=1,NWR+1
  306   WRPAGE(KWR,IX)=RDPAGE(JWR(KWR),IX)
  308   CONTINUE
C
        WRITE(IUNIT,398) CHOP/DCHOP
  398   FORMAT(I3)
        DO 310 IX=1,CHOP+1,DCHOP
  310   WRITE(IUNIT,399) (SCAL(KWR)*WRPAGE(KWR,IX),KWR=1,NWR+1)
  399   FORMAT (8D16.8)
  320   CONTINUE
C
        DO 360 IVR=4,7,3
        DO 360 ISEG=1,4
        CHOP=RCHOP(IVR,ISEG)
        DCHOP=RDCHOP(IVR,ISEG)
        DO 344 IX=1,CHOP+1
        RDPAGE(1,IX)=RDIST(IVR,ISEG,IX)
        RDPAGE(2,IX)=RVC(IVR,ISEG,IX)
        RDPAGE(3,IX)=RPC(IVR,ISEG,IX)
        RDPAGE(19,IX)=RIMPC(IVR,ISEG,IX)
        RDPAGE(20,IX)=RTA(IVR,ISEG,IX)
        RDPAGE(21,IX)=RLCHC(IVR,ISEG,IX)
        RDPAGE(37,IX)=ROSMC(IVR,ISEG,IX)
        RDPAGE(38,IX)=RFVC(IVR,ISEG,IX)
        RDPAGE(54,IX)=RFKC(IVR,ISEG,16,IX)
        RDPAGE(55,IX)=RFKC(IVR,ISEG,17,IX)
        RDPAGE(56,IX)=RFKC(IVR,ISEG,18,IX)
        RDPAGE(57,IX)=RNAE(IVR,ISEG,IX)
        DO 342 ISOL=1,15
        RDPAGE(3+ISOL,IX)=RCC(IVR,ISEG,ISOL,IX)
        RDPAGE(21+ISOL,IX)=RXC(IVR,ISEG,ISOL,IX)
        RDPAGE(38+ISOL,IX)=RFKC(IVR,ISEG,ISOL,IX)
  342   CONTINUE
  344   CONTINUE
        DO 348 IX=1,CHOP+1
        DO 346 KWR=1,NWR+1
  346   WRPAGE(KWR,IX)=RDPAGE(JWR(KWR),IX)
  348   CONTINUE
C
        WRITE(IUNIT,398) CHOP/DCHOP
        DO 350 IX=1,CHOP+1,DCHOP
  350   WRITE(IUNIT,399) (SCAL(KWR)*WRPAGE(KWR,IX),KWR=1,NWR+1)
  360   CONTINUE
C
        IVR=8
        DO 380 ISEG=1,2
        CHOP=RCHOP(IVR,ISEG)
        DCHOP=RDCHOP(IVR,ISEG)
        DO 364 IX=1,CHOP+1
        RDPAGE(1,IX)=RDIST(IVR,ISEG,IX)
        RDPAGE(2,IX)=RVC(IVR,ISEG,IX)
        RDPAGE(3,IX)=RPC(IVR,ISEG,IX)
        RDPAGE(19,IX)=RIMPC(IVR,ISEG,IX)
        RDPAGE(20,IX)=RTA(IVR,ISEG,IX)
        RDPAGE(21,IX)=RLCHC(IVR,ISEG,IX)
        RDPAGE(37,IX)=ROSMC(IVR,ISEG,IX)
        RDPAGE(38,IX)=RFVC(IVR,ISEG,IX)
        RDPAGE(54,IX)=RFKC(IVR,ISEG,16,IX)
        RDPAGE(55,IX)=RFKC(IVR,ISEG,17,IX)
        RDPAGE(56,IX)=RFKC(IVR,ISEG,18,IX)
        RDPAGE(57,IX)=RNAE(IVR,ISEG,IX)
        DO 362 ISOL=1,15
        RDPAGE(3+ISOL,IX)=RCC(IVR,ISEG,ISOL,IX)
        RDPAGE(21+ISOL,IX)=RXC(IVR,ISEG,ISOL,IX)
        RDPAGE(38+ISOL,IX)=RFKC(IVR,ISEG,ISOL,IX)
  362   CONTINUE
  364   CONTINUE
        DO 368 IX=1,CHOP+1
        DO 366 KWR=1,NWR+1
  366   WRPAGE(KWR,IX)=RDPAGE(JWR(KWR),IX)
  368   CONTINUE
C
        WRITE(IUNIT,398) CHOP/DCHOP
        DO 370 IX=1,CHOP+1,DCHOP
  370   WRITE(IUNIT,399) (SCAL(KWR)*WRPAGE(KWR,IX),KWR=1,NWR+1)
  380   CONTINUE
  400   CONTINUE
C
	STOP
	END
C
C
	SUBROUTINE SELEC(VNAME1,VNAME2,JWR)
C PROGRAM TO ASSIGN THE ARRAY COORDINATES FOR THE OUTPUT VARIABLES
C
C FIRST A SURROGATE LUMEN.DAT PAGE IS CREATED:
C        DIST   VC    PC     CC    IMPC   TA   LCHC    XC     OSMC    FVC     FKC    NAE 
C COL:    1     2     3     4-18    19    20    21    22-36    37     38     39-56    57
C
	INTEGER JWR
        CHARACTER*5 VNAME1,VNAME2
C
        IF (VNAME1.EQ.'vc') THEN
        JWR=2
        RETURN
        ELSE IF (VNAME1.EQ.'pc') THEN
        JWR=3
        RETURN
        ELSE IF (VNAME1.EQ.'cc') THEN
        JWR=3
        GO TO 20
        ELSE IF (VNAME1.EQ.'impc') THEN
        JWR=19
        RETURN
        ELSE IF (VNAME1.EQ.'ta') THEN
        JWR=20
        RETURN
        ELSE IF (VNAME1.EQ.'lchc') THEN
        JWR=21
        RETURN
        ELSE IF (VNAME1.EQ.'nae') THEN
        JWR=57
        RETURN
        ELSE IF (VNAME1.EQ.'xc') THEN
        JWR=21
        GO TO 20
        ELSE IF (VNAME1.EQ.'osmc') THEN
        JWR=37
        RETURN
        ELSE IF (VNAME1.EQ.'fvc') THEN
        JWR=38
        RETURN
        ELSE IF (VNAME1.EQ.'fkc') THEN
        JWR=38
        GO TO 20
        ENDIF
C
   20   CONTINUE
	IF(VNAME2.EQ.'na') THEN
        JWR=JWR+1
	ELSE IF(VNAME2.EQ.'k') THEN
        JWR=JWR+2
	ELSE IF(VNAME2.EQ.'cl') THEN
        JWR=JWR+3
	ELSE IF(VNAME2.EQ.'hco3') THEN
        JWR=JWR+4
	ELSE IF(VNAME2.EQ.'h2co3') THEN
        JWR=JWR+5
	ELSE IF(VNAME2.EQ.'co2') THEN
        JWR=JWR+6
	ELSE IF(VNAME2.EQ.'hpo4') THEN
        JWR=JWR+7
	ELSE IF(VNAME2.EQ.'h2po4') THEN
        JWR=JWR+8
	ELSE IF(VNAME2.EQ.'urea') THEN
        JWR=JWR+9
	ELSE IF(VNAME2.EQ.'nh3') THEN
        JWR=JWR+10
	ELSE IF(VNAME2.EQ.'nh4') THEN
        JWR=JWR+11
	ELSE IF(VNAME2.EQ.'h') THEN
        JWR=JWR+12
	ELSE IF(VNAME2.EQ.'gluc') THEN
        JWR=JWR+15
	ELSE IF(VNAME2.EQ.'impc') THEN
        JWR=JWR+16
	ELSE IF(VNAME2.EQ.'ta') THEN
        JWR=JWR+17
	ELSE IF(VNAME2.EQ.'nae') THEN
        JWR=JWR+18
        ENDIF
C
	RETURN
	END
C
	SUBROUTINE RDSEG(*,*)
C PROGRAM TO READ THE VESSEL SEGMENT RECORDS
C
        INTEGER CHOP
C
	DOUBLE PRECISION DIST(901),
     1   VC(901),PC(901),CC(31,901),IMPC(901),
     1   LCHC(901),XC(15,901),FVC(901),FKC(31,901),
     1   QV,QC(31),FVCS(901),FKCS(16,901),
     1   HCTC(901),FBC(901),TA(901),FTA(901),
     1   NAE(901),FNAE(901),OSMC(901)
C
	COMMON/TWR/CHOP,DIST,
     1   VC,PC,CC,IMPC,LCHC,XC,HCTC,OSMC,
     1   FVC,FKC,FBC,QC,QV,FVCS,FKCS,
     1   TA,NAE,FTA,FNAE
C
        READ (1,494)
	DO 405 KX=1,CHOP+1
  405   READ (1,495)  DIST(KX)
  494   FORMAT (5/)
  495   FORMAT (3X,F8.6)
C
        READ (1,419)
	DO 410 KX=1,CHOP+1
  410   READ (1,420) DIST(KX),PC(KX),
     1   (CC(I,KX),I=1,4),(CC(I,KX),I=7,9),
     1   CC(11,KX),CC(13,KX),CC(15,KX),CC(16,KX)
  419   FORMAT (2/)
  420   FORMAT (3X,F8.6,12F11.6)
C
        READ (1,449)
	DO 440 KX=1,CHOP+1
  440   READ (1,450) DIST(KX),VC(KX),
     1  (XC(I,KX),I=1,4),(XC(I,KX),I=7,9),
     1  XC(11,KX),XC(13,KX),XC(15,KX),OSMC(KX)
  449   FORMAT (2/)
  450   FORMAT (3X,F8.6,12F11.6)
C
        READ (1,479)
	DO 470 KX=1,CHOP+1
  470   READ (1,480) DIST(KX), FVC(KX),
     1   (FKC(I,KX),I=1,4),(FKC(I,KX),I=7,9),
     1   FKC(11,KX),FKC(13,KX),FKC(15,KX),
     1   FBC(KX),HCTC(KX)
  479   FORMAT (2/)
  480   FORMAT (3X,F8.6,13F11.6)
C
        READ (1,481)
	DO 472 KX=1,CHOP+1
  472   READ (1,482) DIST(KX),FVCS(KX),
     1  (FKCS(I,KX), I=1,4),(FKCS(I,KX), I=7,9),
     1  FKCS(11,KX), FKCS(13,KX), FKCS(15,KX)
  481   FORMAT (5/)
  482   FORMAT (3X,F8.6,1P,11D11.3)
C
        READ (1,619)
	DO 610 KX=1,CHOP+1
  610   READ (1,620) DIST(KX),TA(KX),NAE(KX)
  619   FORMAT (5/)
  620   FORMAT (3X,F8.6,99X,2F11.6)
C
        READ (1,649)
	DO 640 KX=1,CHOP+1
  640   READ (1,650) DIST(KX),FTA(KX),FNAE(KX)
  649   FORMAT (2/)
  650   FORMAT (3X,F8.6,99X,2F11.6)
C
        RETURN 1
C
  300   RETURN 2
	END
C
