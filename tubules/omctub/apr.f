	PROGRAM APR
C  PROGRAM TO READ AN OUTPUT FILE FROM TUBULE ROUTINE
C  AND COMPUTE ABSOLUTE AND FRACTIONAL REABSORPTIONS
C
C
	INTEGER SOLS,IWR(2,14),JWR(2,14),CHOP
	REAL RES(243,16),TIME,WRRES(4,15,51)
        CHARACTER*12 IPTFIL,OPTFIL
C
	CHARACTER*5 SOL(13)
	SOL(1)='  NA '
	SOL(2)='  K  '
	SOL(3)='  CL '
	SOL(4)=' HCO3'
	SOL(5)='H2CO3'
	SOL(6)=' CO2 '
	SOL(7)=' HPO4'
	SOL(8)='H2PO4'
	SOL(9)=' UREA'
	SOL(10)=' NH3 '
	SOL(11)=' NH4 '
C
C	PRINT 2
    2   FORMAT(' TYPE THE INPUT FILENAME:',$)
C	READ 4, IPTFIL
    4   FORMAT(A12)
C	PRINT 6
    6   FORMAT(' TYPE THE OUTPUT FILENAME:',$)
C	READ 4, OPTFIL
	PRINT 8
    8   FORMAT(' TYPE THE SPATIAL CHOP:',$)
	READ *, CHOP
	CHOP=CHOP+1
C
C	OPEN(UNIT=1,FILE=IPTFIL)
C	OPEN(UNIT=2,FILE=OPTFIL)
	OPEN(UNIT=1,FILE='cdlumen.dat')
	OPEN(UNIT=2,FILE='apr.dat')
	OPEN(UNIT=3,FILE='apr.tab')
C
	SOLS=13
	DO 7 J=1,13
	IWR(1,J)=1+2*CHOP
	JWR(1,J)=2+J
	IWR(2,J)=3*CHOP
    7   JWR(2,J)=2+J
C
	WRITE (2,460) (SOL(I),I=1,SOLS-2)
  460   FORMAT(4X,'FVM',5X,11(A5,4X),/)
	WRITE (3,465)
  465   FORMAT(9X,'X=0',6X,'X=1',4X,'ABSREAB',2X,'RELREAB',/)
C
	DO 810 KZ=1,1000
C
  300   READ (1,310,END=420) TIME
  310   FORMAT (2(/),11X,F15.4)
	READ (1,325) ((RES(I,J),J=1,15),I=1,CHOP)
  325   FORMAT (///,(F7.4,F9.4,F9.2,4F9.6,D9.3,4F9.6,D9.3,2F9.6))
	READ (1,335) ((RES(I,J),J=1,15),I=1+CHOP,2*CHOP)
  335   FORMAT (///,(F7.4,14F9.4))
	READ (1,345) (RES(I,1),(RES(I,J),J=3,15),I=1+2*CHOP,3*CHOP)
  345   FORMAT (///,(F7.4,9X,5F9.6,D9.3,4F9.6,D9.3,2F9.6))
C
C
	DO 400 KY=1,SOLS-1
	WRRES(1,KY,KZ)=RES(IWR(1,KY),JWR(1,KY))
	WRRES(2,KY,KZ)=RES(IWR(2,KY),JWR(2,KY))
	WRRES(3,KY,KZ)=RES(IWR(1,KY),JWR(1,KY))-
     1    RES(IWR(2,KY),JWR(2,KY))
  400   WRRES(4,KY,KZ)=WRRES(3,KY,KZ)/WRRES(1,KY,KZ)
C
  810   CONTINUE
C
  420   DO 410 K=1,KZ-1
	WRITE (2,480) (WRRES(1,J,K),J=1,SOLS-1)
	WRITE (2,480) (WRRES(2,J,K),J=1,SOLS-1)
	WRITE (2,480) (WRRES(3,J,K),J=1,SOLS-1)
  410   WRITE (2,485) (WRRES(4,J,K),J=1,SOLS-1)
  480   FORMAT (5F9.6,2D9.3,3F9.6,D9.3,F9.6)
  485   FORMAT (12F9.6,//)
C
C FF = 1 - units in mul/s*7200 tubules 
C FF = 1/120 - units in mul/min*tubule
C FF = 1000/120 - units in nl/min*tubule
C
	FF=1000./120.
  520   DO 510 K=1,KZ-1
	WRITE (3,579) (FF*WRRES(I,1,K),I=1,3),WRRES(4,1,K)
	DO 515 J=2,5
  515   WRITE (3,580) SOL(J-1),
     1   (1.D3*FF*WRRES(I,J,K),I=1,3),WRRES(4,J,K)
	DO 516 J=6,6
  516   WRITE (3,585) SOL(J-1),
     1   (1.D3*FF*WRRES(I,J,K),I=1,3),WRRES(4,J,K)
	DO 517 J=7,10
  517   WRITE (3,580) SOL(J-1),
     1   (1.D3*FF*WRRES(I,J,K),I=1,3),WRRES(4,J,K)
	WRITE (3,585) SOL(10),
     1   (1.D3*FF*WRRES(I,11,K),I=1,3),WRRES(4,11,K)
	WRITE (3,580) SOL(11),
     1   (1.D3*FF*WRRES(I,12,K),I=1,3),WRRES(4,12,K)
  510   CONTINUE
  579   FORMAT (' FVM ',4F9.2)
  580   FORMAT (A5,3F9.1,F9.2)
  585   FORMAT (A5,3D9.2,F9.2)
	STOP
	END
