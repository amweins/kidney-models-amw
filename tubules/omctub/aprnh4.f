	PROGRAM APR
C  PROGRAM TO READ AN OUTPUT FILE FROM TUBULE ROUTINE
C  AND COMPUTE ABSOLUTE AND FRACTIONAL REABSORPTIONS
C
C
	INTEGER SOLS,IWR(2,14),JWR(2,14),CHOP
	REAL RES(243,16),TIME,WRRES(4,15,51)
        CHARACTER*12 IPTFIL,OPTFIL
C
	CHARACTER*5 SOL(13)
	SOL(1)='  NA '
	SOL(2)='  K  '
	SOL(3)='  CL '
	SOL(4)=' HCO3'
	SOL(5)='H2CO3'
	SOL(6)=' CO2 '
	SOL(7)=' HPO4'
	SOL(8)='H2PO4'
	SOL(9)=' UREA'
	SOL(10)=' NH3 '
	SOL(11)=' NH4 '
C
C	PRINT 2
    2   FORMAT(' TYPE THE INPUT FILENAME:',$)
C	READ 4, IPTFIL
    4   FORMAT(A12)
C	PRINT 6
    6   FORMAT(' TYPE THE OUTPUT FILENAME:',$)
C	READ 4, OPTFIL
	PRINT 8
    8   FORMAT(' TYPE THE SPATIAL CHOP:',$)
	READ *, CHOP
	CHOP=CHOP+1
C
C	OPEN(UNIT=1,FILE=IPTFIL)
C	OPEN(UNIT=2,FILE=OPTFIL)
	OPEN(UNIT=1,FILE='cdlumen.dat')
	OPEN(UNIT=2,FILE='apr.nh4')
C
	SOLS=13
	FF=1.E6/120.
	DO 7 J=1,13
	IWR(1,J)=1+2*CHOP
	JWR(1,J)=2+J
	IWR(2,J)=3*CHOP
    7   JWR(2,J)=2+J
C
	WRITE (2,460) SOL(4),SOL(7),SOL(11)
  460   FORMAT(5X,3(A5,11X),/)
C
	DO 810 KZ=1,1000
C
  300   READ (1,310,END=420) TIME
  310   FORMAT (2(/),11X,F15.4)
	READ (1,325) ((RES(I,J),J=1,15),I=1,CHOP)
  325   FORMAT (///,(F7.4,F9.4,F9.2,4F9.6,D9.3,4F9.6,D9.3,2F9.6))
	READ (1,335) ((RES(I,J),J=1,15),I=1+CHOP,2*CHOP)
  335   FORMAT (///,(F7.4,14F9.4))
	READ (1,345) (RES(I,1),(RES(I,J),J=3,15),I=1+2*CHOP,3*CHOP)
  345   FORMAT (///,(F7.4,9X,5F9.6,D9.3,4F9.6,D9.3,2F9.6))
C
C
	DO 400 KY=1,SOLS-1
	WRRES(1,KY,KZ)=RES(IWR(1,KY),JWR(1,KY))
	WRRES(2,KY,KZ)=RES(IWR(2,KY),JWR(2,KY))
	WRRES(3,KY,KZ)=RES(IWR(1,KY),JWR(1,KY))-
     1    RES(IWR(2,KY),JWR(2,KY))
  400   WRRES(4,KY,KZ)=WRRES(3,KY,KZ)/WRRES(1,KY,KZ)
C
  810   CONTINUE
C
  420   DO 410 K=1,KZ-1
	WRITE (2,480) FF*WRRES(3,5,K),FF*WRRES(3,8,K),-FF*WRRES(3,12,K),
     1    FF*(WRRES(3,5,K)+WRRES(3,8,K)-WRRES(3,12,K))
  410   CONTINUE
  480   FORMAT (8E16.8)
C
C FF = 1 - units in mul/s*7200 tubules 
C FF = 1/120 - units in mul/min*tubule
C FF = 1000/120 - units in nl/min*tubule
C
	STOP
	END
