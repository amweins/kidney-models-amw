	SUBROUTINE SFPCTORQUE(SWT)
C
C SUBROUTINE TO SET COMPLIANCE AND TORQUE VARIABLES (SWT=1)
C  TO COMPUTE TUBULE RADIUS AND TORQUE, AND MODULATE PARAMETERS (SWT=2)
C   TO OUTPUT TORQUE-RELATED VARIABLES (SWT=3)
C
	INTEGER SOLS,T,X,SWT,CHOP
C
C GENERAL PARAMETERS
	DOUBLE PRECISION
     1   Z(15),RT,RTE,F,DIST,
     1   EPSI,DT,RTAU,TIME,L0,L(1601,2),
     1   PKC,PKF,PKN,PKP,KHY(5),KDHY(5)
C LUMINAL AND PERITUBULAR PARAMETERS
	DOUBLE PRECISION
     1   VM(1601,2),PM(1601,2),CM(15,1601,2),
     1   IMPM(1601,2),LCHM(1601),XM(15,1601),
     1   VS(1601,2),PS(1601,2),CS(15,1601,2),
     1   IMPS(1601,2),LCHS(1601),XS(15,1601),
     1   TL,DX,RM0,MUM,ETA,ZIMPS,
     1   SM(1601,2),AM(1601,2),FVM(1601,2),FKM(16,1601,2)
C INTERSPACE PARAMETERS
	DOUBLE PRECISION
     1   AME,AE0,AE(1601,2),MUA,CHVL0,CHVL(1601,2),MUV,
     1   LPME,LPES,SME(15),SES(15),
     1   HME(15),HES(15),CME(15),CES(15),
     1   VE(1601,2),PE(1601,2),CE(15,1601,2),LCHE(1601),XE(15,1601),
     1   FEVM(1601,2),FEKM(15,1601,2),FEVS(1601,2),FEKS(15,1601,2),
     1   CURE(1601)
C CELL PARAMETERS
	DOUBLE PRECISION
     1   AIE(3),AMI(3),AIS(3),AI0(3),CLVL0(3),IMP0(3),CLVL(3,1601,2),
     1   ZIMP(3),TBUF(3),PKB(3),CBUF(3,1601,2),HCBUF(3,1601,2),
     1   LPMI(3),LPIS(3),SMI(3,15),SIS(3,15),
     1   HMI(3,15),HIS(3,15),CMI(3,15),CIE(3,15),CIS(3,15),
     1   LMI(3,15,15),LIS(3,15,15),
     1   ATMI(3,15,1601),ATIS(3,15,1601),ATIE(3,15,1601),
     1   VI(3,1601,2),PI(3,1601,2),CI(3,15,1601,2),IMP(3,1601),
     1   LCHI(3,1601),XI(3,15,1601),FIVM(3,1601,2),FIKM(3,15,1601,2),
     1   FIVS(3,1601,2),FIKS(3,15,1601,2),CURI(3,1601),JV(3,1601,2),
     1   JK(3,15,1601,2)
C SPECIAL TRANSPORTERS
	CHARACTER*1 ISOFM
	DOUBLE PRECISION
     1   NP(3),KNPN(3),KNPK(3),KNH4(3),NPHK(3),
     1   LHP(3),XIHP(3),XHP(3),NAE1(3),NTSC(3),NNHE3(3),
     1   JNAK(3,3,1601,2),JHK(3,1601,2),JHP(3,1601,2),
     1   JAE1(3,1601,2),JTSC(3,1601,2),JNHE3(3,3,1601,2),QIAMM,
     1   NNKCC(3),NKCL(3),JNKCC(3,4,1601,2),JKCC(3,3,1601,2)
C TORQUE AND COMPLIANCE VARIABLES
	DOUBLE PRECISION
     1   TQM(81,2),RM(81,2),MUR,SCALMI,SCALIS,VM0,AM0,TQM0,
     1   LHP0(3),NP0(3),NNHE30(3),LPMI0(3),LPIS0(3),
     1   HMI0(3,15),HIS0(3,15),LMI0(3,15,15),LIS0(3,15,15),
     1   QIAMM0,MVL,MVD,RMT0
C
C
        COMMON SOLS,T,X,CHOP,
     1   Z,RT,RTE,F,
     1   EPSI,DT,RTAU,TIME,DIST,
     1   PKC,PKF,PKN,PKP,KHY,KDHY,L0,L,
     1   VM,PM,CM,IMPM,LCHM,XM,
     1   VS,PS,CS,IMPS,LCHS,XS,
     1   TL,DX,RM0,MUM,ETA,ZIMPS,
     1   SM,AM,FVM,FKM,
     1   AME,AE0,AE,MUA,CHVL0,CHVL,MUV,
     1   LPME,LPES,SME,SES,
     1   HME,HES,CME,CES,
     1   VE,PE,CE,LCHE,XE,
     1   FEVM,FEKM,FEVS,FEKS,CURE,
     1   AIE,AMI,AIS,AI0,CLVL0,IMP0,CLVL,
     1   ZIMP,TBUF,PKB,CBUF,HCBUF,
     1   LPMI,LPIS,SMI,SIS,
     1   HMI,HIS,CMI,CIE,CIS,
     1   LMI,LIS,ATMI,ATIS,ATIE,
     1   VI,PI,CI,IMP,LCHI,XI,
     1   FIVM,FIKM,FIVS,FIKS,CURI,
     1   JV,JK
	COMMON/KINET/ ISOFM,
     1   NP,KNPN,KNPK,KNH4,NPHK,
     1   LHP,XIHP,XHP,NAE1,NTSC,NNHE3,
     1   JNAK,JHK,JHP,JAE1,JTSC,JNHE3,QIAMM,
     1   NNKCC,NKCL,JNKCC,JKCC
	COMMON/TORQUE/
     1   TQM,RM,MUR,SCALMI,SCALIS,VM0,AM0,TQM0,
     1   LHP0,NP0,NNHE30,LPMI0,LPIS0,
     1   HMI0,HIS0,LMI0,LIS0,QIAMM0,MVL,MVD,RMT0
C
	MVL=2.5D-4
	MVD=1.5D-5
C
	GO TO (100,200,300) SWT
C
C FIRST PASS OF THE PROGRAM: INITIAL PARAMETERS ARE SET.
C
  100   CONTINUE
	DO 80 K=1,1
	LHP0(K)=LHP(K)
	NP0(K)=NP(K)
	NNHE30(K)=NNHE3(K)
	LPMI0(K)=LPMI(K)
	LPIS0(K)=LPIS(K)
	DO 72 I=1,SOLS
	HMI0(K,I)=HMI(K,I)
	HIS0(K,I)=HIS(K,I)
   72   CONTINUE
	DO 75 I=1,SOLS
	DO 75 J=1,SOLS
	LMI0(K,I,J)=LMI(K,I,J)
	LIS0(K,I,J)=LIS(K,I,J)
   75   CONTINUE
	QIAMM0=QIAMM
C
   80   CONTINUE
C
C	RM(1,T)=RM0*(1.0 + MUR*(PM(1,T)-PS(1,T)))
	RM(1,T)=RM0*(1.0 + 0.5*DTANH(MUR*(PM(1,T)-PS(1,T))))
	AM0=3.14D0*(RMT0**2)*MUM
	AM(1,T)=3.14D0*(RM(1,T)**2)*MUM
C
C THE REFERENCE TORQUE IS COMPUTED WITH RESPECT TO RMT0
C WHICH IS A DIFFERENT RADIUS FROM RM0, USED IN THE COMPLIANCE CALCULATION
C
	TQM0=VM0*
     1   (1.0 + (MVL+MVD)/RMT0 + 0.5*(MVL/RMT0)**2)*ETA
	TQM(1,T)=(FVM(1,T)/AM(1,T))*
     1   (1.0 + (MVL+MVD)/RM(1,T) + 0.5*(MVL/RM(1,T))**2)*ETA
C
	RETURN
C
C MDULATION OF MODEL PARAMTERS WITH TORQUE
C
  200   CONTINUE
C
C	RM(X,T)=RM0*(1.0 + MUR*(PM(X,T)-PS(X,T)))
	RM(X,T)=RM0*(1.0 + 0.5*DTANH(MUR*(PM(X,T)-PS(X,T))))
	AM(X,T)=3.14D0*(RM(X,T)**2)*MUM
	TQM(X,T)=(FVM(X,T)/AM(X,T))*
     1   (1.0 + (MVL+MVD)/RM(X,T) + 0.5*(MVL/RM(X,T))**2)*ETA
C
	DO 180 K=1,1
	LHP(K)=LHP0(K)*(1.0 + SCALMI*(TQM(X,T)/TQM0 -1.0))
	NP(K)=NP0(K)*(1.0 + SCALIS*(TQM(X,T)/TQM0 -1.0))
	NNHE3(K)=NNHE30(K)*(1.0 + SCALMI*(TQM(X,T)/TQM0 -1.0))
	LPMI(K)=LPMI0(K)*(1.0 + SCALMI*(TQM(X,T)/TQM0 -1.0))
	LPIS(K)=LPIS0(K)*(1.0 + SCALIS*(TQM(X,T)/TQM0 -1.0))
	DO 172 I=1,SOLS
	HMI(K,I)=HMI0(K,I)*(1.0 + SCALMI*(TQM(X,T)/TQM0 -1.0))
	HIS(K,I)=HIS0(K,I)*(1.0 + SCALIS*(TQM(X,T)/TQM0 -1.0))
  172   CONTINUE
	DO 175 I=1,SOLS
	DO 175 J=1,SOLS
	LMI(K,I,J)=LMI0(K,I,J)*(1.0 + SCALMI*(TQM(X,T)/TQM0 -1.0))
	LIS(K,I,J)=LIS0(K,I,J)*(1.0 + SCALIS*(TQM(X,T)/TQM0 -1.0))
  175   CONTINUE
	QIAMM=QIAMM0*(1.0 + SCALMI*(TQM(X,T)/TQM0 -1.0))
C
  180   CONTINUE
C
	RETURN
C
C   TO OUTPUT TORQUE-RELATED VARIABLES (SWT=3)
C
  300   CONTINUE
C
	DO 210 K=1,CHOP+1
  210	WRITE(17,215) FLOAT(K-1)*DX,
     1   PM(K,T),1.D4*RM(K,T),AM(K,T)/AM0,
     1   FVM(K,T)/FVM(1,T),FVM(K,T)/AM(K,T),TQM(K,T)/TQM0
  215   FORMAT(8D16.8)
C
	RETURN
	END
