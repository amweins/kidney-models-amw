	PROGRAM DNWR
C  PROGRAM TO READ AN OUTPUT FILE FROM DN.F
C
C
	INTEGER NWR,IWR(20),JWR(20),CHOP(7),DCHOP(7)
	REAL WRRES(3601,200),TL,RDRES(3601,20)
        CHARACTER*12 IPTFIL,OPTFIL,VARNAM
        CHARACTER*5 VNAME1(20),VNAME2(20),SWI,SWO
	CHARACTER*4 SEGNAM(7)
C
	COMMON/TWR/NWR,IWR,JWR,RDRES
	DATA SEGNAM
     1   /'AHLM','AHLC',' DCT',' CNT',' CCT','OMCT','IMCT'/
C
	PRINT 2
    2   FORMAT(' TYPE THE INPUT FILENAME:',$)
	READ 4, IPTFIL
    4   FORMAT(A12)
	PRINT 6
    6   FORMAT(' TYPE THE OUTPUT FILENAME:',$)
	READ 4, OPTFIL
C
	PRINT 3
    3   FORMAT(' MESH SPACING - DATA FILE OR INTERACTIVE? (d/i):',$)
	READ *, SWI
	IF (SWI.EQ.'i') GO TO 7
	OPEN(4,FILE='dnmesh.dat')
	READ (4,5) (CHOP(L),DCHOP(L),L=1,7)
    5   FORMAT(2I5)
	GO TO 12
C
    7   DO 10 K=1,7
	PRINT 8, SEGNAM(K)
    8   FORMAT(A4,' SPATIAL CHOP, AND PRINT SPACING:',$) 
	READ *, CHOP(K),DCHOP(K)
   10   CONTINUE
C
   12   DO 13 L=1,7
   13   CHOP(L)=CHOP(L)+1
C
	OPEN(1,FILE=IPTFIL)
	OPEN(2,FILE=OPTFIL)
	IWR(1)=1
	JWR(1)=1
C
	PRINT 500
  500   FORMAT(' IS INPUT FROM A DATA FILE OR INTERACTIVE? (d/i): ',$)
	READ 30, SWI
  510   IF (SWI.EQ.'i') GO TO 15
	PRINT 516
  516   FORMAT(' TYPE THE VARIABLE FILENAME:',$)
	READ 4, VARNAM
	OPEN(3,FILE=VARNAM)
	READ (3,515) NWR
  515   FORMAT(3X,I2)
	DO 525 KWR=2,NWR+1
  525   READ (3,530) VNAME1(KWR),VNAME2(KWR)
  530   FORMAT(2A5)
	GO TO 801
C
C
   15   PRINT 16
   16   FORMAT(' TYPE THE NUMBER OF VARIABLES TO BE REWRITTEN')
	READ *, NWR
	DO 50 KWR=2,NWR+1
	PRINT 20, KWR-1
   20   FORMAT(' TYPE THE NAME OF VARIABLE NUMBER-',I2)
	READ 30, VNAME1(KWR)
   30   FORMAT(A5)
	IF(VNAME1(KWR).EQ.'cm') GO TO 40
	IF(VNAME1(KWR).EQ.'xm') GO TO 40
	IF(VNAME1(KWR).EQ.'fkm') GO TO 40
	GO TO 50
C
   40   PRINT 45
   45   FORMAT(' TYPE THE SPECIES')
	READ 30, VNAME2(KWR)
   50   CONTINUE
C
C THE WRITTEN VARIABLES HAVE BEEN SPECIFIED, AS HAS TUBULE SEGMENTATION
C
  801   TL=0.0
	DO 900 KXP=1,100
C
C DATA FOR EACH SEGMENT IS READ
C
	ISEG=0
	DO 820 KSEG=1,7
	DO 810 KWR=1,NWR+1
  810   CALL SELEC 
     1   (VNAME1(KWR),VNAME2(KWR),IWR(KWR),JWR(KWR),CHOP(KSEG))
	CALL RDSEG(CHOP(KSEG),*811,*901)
  811   IF (KXP.GT.1) GO TO 815
	DO 812 I=1,CHOP(KSEG)
  812   WRRES(I+ISEG,1)=RDRES(I,1) + TL
  815   DO 817 J=2,NWR+1
	DO 817 I=1,CHOP(KSEG)
  817   WRRES(I+ISEG,J+(KXP-1)*NWR)=RDRES(I,J)
	ISEG=ISEG+CHOP(KSEG)
	TL=TL + RDRES(CHOP(KSEG),1)
  820   CONTINUE
C	
  900   CONTINUE
C
C WRRES HAS BEEN FILLED. DISTANCE IS BY ROW, AND VALUE ACROSS THE COLUMNS.
C
  901   KXP=KXP-1
	PRINT 909
  909   FORMAT(' FULL CD PROFILE OR JUST FINAL URINE? (x/u): ',$)
	READ *, SWO
	IF (SWO.EQ.'u') GO TO 950
C
	ISEG=0
	DO 920 KSEG=1,7
	DO 910 I=1+ISEG,ISEG+CHOP(KSEG),DCHOP(KSEG)
  910   WRITE (2,905) (WRRES(I,J),J=1,KXP*NWR+1)
  905   FORMAT (8E16.8)
	ISEG=ISEG+CHOP(KSEG)
  920   CONTINUE
	STOP
C
  950   DO 955 K=1,KXP
  955   WRITE (2,905) (WRRES(ISEG,J),J=2 + (K-1)*NWR, 1 + K*NWR)
C
	STOP
	END
C
C
	SUBROUTINE SELEC(VNAME1,VNAME2,IWR,JWR,CHOP)
C PROGRAM TO ASSIGN THE ARRAY COORDINATES FOR THE OUTPUT VARIABLES
C
	INTEGER IWR,JWR,CHOP
        CHARACTER*5 VNAME1,VNAME2
C
C
	IF(VNAME1.EQ.'vm') GO TO 501
	IF(VNAME1.EQ.'pm') GO TO 502
	IF(VNAME1.EQ.'cm') GO TO 503
	IF(VNAME1.EQ.'phm') GO TO 504
	IF(VNAME1.EQ.'xm') GO TO 505
	IF(VNAME1.EQ.'fvm') GO TO 506
	IF(VNAME1.EQ.'fkm') GO TO 507
C	IF(VNAME1.EQ.'pheq') GO TO 508
	IF(VNAME1.EQ.'ta') GO TO 508
	IF(VNAME1.EQ.'osmm') GO TO 509
C
C
  501   IWR=1
	JWR=2
	GO TO 700
  502   IWR=1
	JWR=3
	GO TO 700
  503   IWR=1
	JWR=4
	GO TO 600
  508   IWR=1+CHOP
	JWR=2
	GO TO 700
  504   IWR=1+CHOP
	JWR=3
	GO TO 700
  505   IWR=1+CHOP
	JWR=4
	GO TO 600
  506   IWR=1+2*CHOP
	JWR=3
	GO TO 700
  507   IWR=1+2*CHOP
	JWR=4
	GO TO 600
  509   IWR=1+2*CHOP
	JWR=2
	GO TO 700
C
C
  600   CONTINUE
C
	IF(VNAME2.EQ.'na') GO TO 621
	IF(VNAME2.EQ.'k') GO TO 622
	IF(VNAME2.EQ.'cl') GO TO 623
	IF(VNAME2.EQ.'hco3') GO TO 624
	IF(VNAME2.EQ.'h2co3') GO TO 625
	IF(VNAME2.EQ.'co2') GO TO 626
	IF(VNAME2.EQ.'hpo4') GO TO 627
	IF(VNAME2.EQ.'h2po4') GO TO 628
	IF(VNAME2.EQ.'urea') GO TO 629
	IF(VNAME2.EQ.'nh3') GO TO 630
	IF(VNAME2.EQ.'nh4') GO TO 631
	IF(VNAME2.EQ.'h') GO TO 632
	IF(VNAME2.EQ.'impm') GO TO 632
	IF(VNAME2.EQ.'ta') GO TO 632
C
C
  621   JWR=JWR+0
	GO TO 700
  622   JWR=JWR+1
	GO TO 700
  623   JWR=JWR+2
	GO TO 700
  624   JWR=JWR+3
	GO TO 700
  625   JWR=JWR+4
	GO TO 700
  626   JWR=JWR+5
	GO TO 700
  627   JWR=JWR+6
	GO TO 700
  628   JWR=JWR+7
	GO TO 700
  629   JWR=JWR+8
	GO TO 700
  630   JWR=JWR+9
	GO TO 700
  631   JWR=JWR+10
	GO TO 700
  632   JWR=JWR+11
	GO TO 700
C
  700   CONTINUE
	RETURN
	END
C
C
	SUBROUTINE RDSEG(CHOP,*,*)
C PROGRAM TO READ THE TUBULE SEGMENT RECORDS AND OUTPUT THE SELECTED VARIABLES
C
	INTEGER NWR,IWR(20),JWR(20),CHOP
	REAL RES(4803,16),TIME,RDRES(3601,20)
C
	COMMON/TWR/NWR,IWR,JWR,RDRES
C
C
  300   READ (1,310,END=360) TIME
  310   FORMAT (2(/),11X,F15.4)
	READ (1,325) ((RES(I,J),J=1,15),I=1,CHOP)
  325   FORMAT (///,(F7.4,F9.4,F9.2,4F9.6,D9.3,4F9.6,D9.3,2F9.6))
	READ (1,335) ((RES(I,J),J=1,15),I=1+CHOP,2*CHOP)
  335   FORMAT (///,(F7.4,14F9.4))
	READ (1,345) ((RES(I,J),J=1,15),I=1+2*CHOP,3*CHOP)
  345   FORMAT (///,(F7.4,6F9.6,D9.3,4F9.6,D9.3,2F9.6))
C
	DO 349 I=1,CHOP
  349   RDRES(I,1)=RES(I,1)
	DO 350 J=2,NWR+1
	DO 350 I=1,CHOP
  350   RDRES(I,J)=RES(IWR(J)+I-1,JWR(J))
C
	RETURN 1
  360   RETURN 2
	END
C
