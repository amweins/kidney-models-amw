	PROGRAM BCRV
C BCR-PROGRAM TO CREATE THE FILE BOUND.DAT TO BE READ BY COMP.FOR
C   IT IS ASSUMED THAT THE SOLUTION IS MADE UP VIA HCL TITRATION:
C   I.E. FIRST THE HCO3 CONCENTRATION IS SPECIFIED ALONG WITH THE TOTAL
C   CONCENTRATION OF THE OTHER BUFFERS; NEXT THE BUFFER PAIRS ARE 
C   ADJUSTED; AND FINALLY THE CL CONCENTRATION IS CALCULATED FROM 
C   ELECTRONEUTRALITY.
C BCRV-Allows for and arry of boundary values (rather than a vector)
C
	INTEGER SOLS,TLIM(2)
C
	DOUBLE PRECISION
     1   Z,ZIMPM,ZIMPS,
     1   PKC,PKP,PKN,KCO2,
     1   TPM,TNM,QPM,QNM,
     1   TPS,TNS,QPS,QNS,
     1   VM,PM,CM,VS,PS,CS,IMPM,IMPS,
     1   LCHM,LCHS,DT
C
	DIMENSION Z(12),CM(12),CS(12)
C
	INTEGER NWR,IWR(5),JWR(5)
	CHARACTER*4 VNAME1,VNAME2
	CHARACTER*1 SWEQ
	DOUBLE PRECISION VMAT(12,3),VINCR(5)
C
	EQUIVALENCE(VMAT(1,1),VM)
	EQUIVALENCE(VMAT(2,1),PM)
	EQUIVALENCE(VMAT(3,1),IMPM)
	EQUIVALENCE(VMAT(4,1),VS)
	EQUIVALENCE(VMAT(5,1),PS)
	EQUIVALENCE(VMAT(6,1),IMPS)
	EQUIVALENCE(VMAT(1,2),CM(1))
	EQUIVALENCE(VMAT(1,3),CS(1))
C
C
	OPEN (19,FILE='bound.tem')
	OPEN (22,FILE='bound.dat')
C
	SOLS=12
C
C  SOLUTE INDEX:
C	1-	NA+
C	2-	K+
C	3-	CL-
C	4-	HCO3-
C	5-	H2CO3
C	6-	CO2
C	7-	HPO4--
C	8-	H2PO4-
C	9-	UREA
C	10-	NH3
C	11-	NH4+
C	12-	H+
C
	Z(1)=1.D0
	Z(2)=1.D0
	Z(3)=-1.D0
	Z(4)=-1.D0
	Z(5)=0.D0
	Z(6)=0.D0
	Z(7)=-2.D0
	Z(8)=-1.D0
	Z(9)=0.D0
	Z(10)=0.D0
	Z(11)=1.D0
	Z(12)=1.D0
	ZIMPM=1.D0
	ZIMPS=-0.D0
C
	PKC=3.57
	PKP=6.8
	PKN=9.15
	KCO2=340.
C
C
	NWR=2
	DO 800 KWR=1,NWR
	PRINT 20, KWR
   20   FORMAT(' PRINT THE NAME OF VARIABLE NUMBER-',I2)
	READ 30, VNAME1
   30   FORMAT(A4)
C
	IF(VNAME1.EQ.'vm') GO TO 101
	IF(VNAME1.EQ.'pm') GO TO 102
	IF(VNAME1.EQ.'impm') GO TO 103
	IF(VNAME1.EQ.'vs') GO TO 104
	IF(VNAME1.EQ.'ps') GO TO 105
	IF(VNAME1.EQ.'imps') GO TO 106
	IF(VNAME1.EQ.'cm') GO TO 107
	IF(VNAME1.EQ.'cs') GO TO 108
C
  101   IWR(KWR)=1
	JWR(KWR)=1
	GO TO 700
  102   IWR(KWR)=2
	JWR(KWR)=1
	GO TO 700
  103   IWR(KWR)=3
	JWR(KWR)=1
	GO TO 700
  104   IWR(KWR)=4
	JWR(KWR)=1
	GO TO 700
  105   IWR(KWR)=5
	JWR(KWR)=1
	GO TO 700
  106   IWR(KWR)=6
	JWR(KWR)=1
	GO TO 700
  107   IWR(KWR)=1
	JWR(KWR)=2
	GO TO 200
  108   IWR(KWR)=1
	JWR(KWR)=3
	GO TO 200
C
  200   PRINT 201
  201   FORMAT(' PRINT THE SPECIES')
	READ 30, VNAME2
C
	IF(VNAME2.EQ.'na') GO TO 221
	IF(VNAME2.EQ.'k') GO TO 222
	IF(VNAME2.EQ.'cl') GO TO 223
	IF(VNAME2.EQ.'hco3') GO TO 224
	IF(VNAME2.EQ.'h2co3') GO TO 225
	IF(VNAME2.EQ.'co2') GO TO 226
	IF(VNAME2.EQ.'hpo4') GO TO 227
	IF(VNAME2.EQ.'h2po4') GO TO 228
	IF(VNAME2.EQ.'urea') GO TO 229
	IF(VNAME2.EQ.'nh3') GO TO 230
	IF(VNAME2.EQ.'nh4') GO TO 231
C
C
  221   IWR(KWR)=IWR(KWR)+0
	GO TO 700
  222   IWR(KWR)=IWR(KWR)+1
	GO TO 700
  223   IWR(KWR)=IWR(KWR)+2
	GO TO 700
  224   IWR(KWR)=IWR(KWR)+3
	GO TO 700
  225   IWR(KWR)=IWR(KWR)+4
	GO TO 700
  226   IWR(KWR)=IWR(KWR)+5
	GO TO 700
  227   IWR(KWR)=IWR(KWR)+6
	GO TO 700
  228   IWR(KWR)=IWR(KWR)+7
	GO TO 700
  229   IWR(KWR)=IWR(KWR)+8
	GO TO 700
  230   IWR(KWR)=IWR(KWR)+9
	GO TO 700
  231   IWR(KWR)=IWR(KWR)+10
	GO TO 700
C
  700   PRINT 710
  710   FORMAT(' VARIABLE INCREMENT=',$)
	READ *, VINCR(KWR)
C
  800   CONTINUE
  801   CONTINUE
C
C
C BOUNDARY VALUES,ACTIVE TRANSPORT,AND THE TIME INCREMENT ARE
C READ. THE TIME STEP WILL CYCLE FROM THIS POINT.
C
	READ(19,50) DT,VM,PM,IMPM,VS,PS,IMPS,
     1  (CM(I),CS(I),I=1,SOLS-1)
   50   FORMAT (D12.4,/,6F8.4,/,(2F14.9))
C
	PRINT 60
   60   FORMAT(' TLIM(1)=',$)
	READ *, TLIM(1)
	PRINT 61
   61   FORMAT(' TLIM(2)=',$)
	READ *, TLIM(2)
C
C	1-	NA+
C	2-	K+
C	3-	CL-
C	4-	HCO3-
C	5-	H2CO3
C	6-	CO2
C	7-	HPO4--
C	8-	H2PO4-
C	9-	UREA
C	10-	NH3
C	11-	NH4+
C	12-	H+
C
C CHECK EQUILIBRIUM BETWEEN DISSOLVED CO2 AND H2CO3
C
	PRINT 120
  120   FORMAT('Assumed equilibrium pH? (y/n)  ',$)
	READ *, SWEQ
C
	DO 900 K1=1,TLIM(1)
	DO 899 K2=1,TLIM(2)
C
	IF (SWEQ.EQ.'n') GO TO 122
	CM(5)=CM(6)/KCO2
	CS(5)=CS(6)/KCO2
C
  122   LCHM=PKC + DLOG10(CM(4)/CM(5))
	LCHS=PKC + DLOG10(CS(4)/CS(5))
C
	TPM=CM(7)+CM(8)
	TNM=CM(10)+CM(11)
	TPS=CS(7)+CS(8)
	TNS=CS(10)+CS(11)
C
	QPM=10.**(LCHM-PKP)
	QNM=10.**(LCHM-PKN)
	QPS=10.**(LCHS-PKP)
	QNS=10.**(LCHS-PKN)
C
	CM(8)=TPM/(1.+QPM)
	CM(7)=TPM-CM(8)
	CM(11)=TNM/(1.+QNM)
	CM(10)=TNM-CM(11)
C
	CS(8)=TPS/(1.+QPS)
	CS(7)=TPS-CS(8)
	CS(11)=TNS/(1.+QNS)
	CS(10)=TNS-CS(11)
C
	CM(3)=IMPM*ZIMPM + CM(1)*Z(1) + CM(2)*Z(2)
	CS(3)=IMPS*ZIMPS + CS(1)*Z(1) + CS(2)*Z(2)
	DO 130 I=4,SOLS
	CM(3)=CM(3)+CM(I)*Z(I)
	CS(3)=CS(3)+CS(I)*Z(I)
  130   CONTINUE
C
	WRITE (22,150) DT,VM,PM,IMPM,VS,PS,IMPS,
     1  (CM(I),CS(I),I=1,SOLS-1)
  150   FORMAT (D12.4,/,6F8.4,/,(2F14.9))
C
C
	KWR=2
	VMAT(IWR(KWR),JWR(KWR))=VMAT(IWR(KWR),JWR(KWR))+VINCR(KWR)
  899   CONTINUE
	VMAT(IWR(KWR),JWR(KWR))=VMAT(IWR(KWR),JWR(KWR))
     1    -FLOAT(TLIM(KWR))*VINCR(KWR)
	KWR=1
	VMAT(IWR(KWR),JWR(KWR))=VMAT(IWR(KWR),JWR(KWR))+VINCR(KWR)
C
  900   CONTINUE
	STOP
	END
