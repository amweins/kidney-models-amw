	PROGRAM BCR
C BCR-PROGRAM TO CREATE THE FILE BOUND.DAT TO BE READ BY COMP.FOR
C   IT IS ASSUMED THAT THE SOLUTION IS MADE UP VIA HCL TITRATION:
C   I.E. FIRST THE HCO3 CONCENTRATION IS SPECIFIED ALONG WITH THE TOTAL
C   CONCENTRATION OF THE OTHER BUFFERS; NEXT THE BUFFER PAIRS ARE 
C   ADJUSTED; AND FINALLY THE CL CONCENTRATION IS CALCULATED FROM 
C   ELECTRONEUTRALITY.
C
	INTEGER SOLS,TLIM
C
	DOUBLE PRECISION
     1   Z,ZIMPM,ZIMPS,
     1   PKC,PKF,PKP,PKN,KCO2,
     1   TFM,TPM,TNM,QFM,QPM,QNM,
     1   TFM,TPS,TNS,QFM,QPS,QNS,
     1   VM,PM,CM,VS,PS,CS,IMPM,IMPS,
     1   LCHM,LCHS,DT
C
	DIMENSION Z(15),CM(15),CS(15)
C
	INTEGER NWR,IWR(5),JWR(5)
	CHARACTER*4 VNAME1,VNAME2
	CHARACTER*1 SWEQ
	DOUBLE PRECISION VMAT(15,3),VINCR(5)
C
	EQUIVALENCE(VMAT(1,1),VM)
	EQUIVALENCE(VMAT(2,1),PM)
	EQUIVALENCE(VMAT(3,1),IMPM)
	EQUIVALENCE(VMAT(4,1),VS)
	EQUIVALENCE(VMAT(5,1),PS)
	EQUIVALENCE(VMAT(6,1),IMPS)
	EQUIVALENCE(VMAT(1,2),CM(1))
	EQUIVALENCE(VMAT(1,3),CS(1))
C
C
	OPEN (19,FILE='bound.tem')
	OPEN (22,FILE='bound.dat')
C
	SOLS=15
C
C  SOLUTE INDEX:
C	1-	NA+
C	2-	K+
C	3-	CL-
C	4-	HCO3-
C	5-	H2CO3
C	6-	CO2
C	7-	HPO4--
C	8-	H2PO4-
C	9-	UREA
C	10-	NH3
C	11-	NH4+
C	12-	H+
C	13-	HCO2-
C	14-	H2CO2
C	15-	GLUCOSE
C
	Z(1)=1.D0
	Z(2)=1.D0
	Z(3)=-1.D0
	Z(4)=-1.D0
	Z(5)=0.D0
	Z(6)=0.D0
	Z(7)=-2.D0
	Z(8)=-1.D0
	Z(9)=0.D0
	Z(10)=0.D0
	Z(11)=1.D0
	Z(12)=1.D0
	Z(13)=-1.D0
	Z(14)=0.D0
	Z(15)=0.D0
	ZIMPM=1.D0
	ZIMPS=-0.D0
C
	PKC=3.57
	PKF=3.76
	PKN=9.15
	PKP=6.8
	KCO2=340.
C
C
	PRINT 10
   10   FORMAT(' PRINT THE NUMBER OF VARIABLES TO BE INCREMENTED')
	READ *, NWR
	IF(NWR.EQ.0) GO TO 801
	DO 800 KWR=1,NWR
	PRINT 20, KWR
   20   FORMAT(' PRINT THE NAME OF VARIABLE NUMBER-',I2)
	READ 30, VNAME1
   30   FORMAT(A4)
C
	IF(VNAME1.EQ.'vm') GO TO 101
	IF(VNAME1.EQ.'pm') GO TO 102
	IF(VNAME1.EQ.'impm') GO TO 103
	IF(VNAME1.EQ.'vs') GO TO 104
	IF(VNAME1.EQ.'ps') GO TO 105
	IF(VNAME1.EQ.'imps') GO TO 106
	IF(VNAME1.EQ.'cm') GO TO 107
	IF(VNAME1.EQ.'cs') GO TO 108
C
  101   IWR(KWR)=1
	JWR(KWR)=1
	GO TO 700
  102   IWR(KWR)=2
	JWR(KWR)=1
	GO TO 700
  103   IWR(KWR)=3
	JWR(KWR)=1
	GO TO 700
  104   IWR(KWR)=4
	JWR(KWR)=1
	GO TO 700
  105   IWR(KWR)=5
	JWR(KWR)=1
	GO TO 700
  106   IWR(KWR)=6
	JWR(KWR)=1
	GO TO 700
  107   IWR(KWR)=1
	JWR(KWR)=2
	GO TO 200
  108   IWR(KWR)=1
	JWR(KWR)=3
	GO TO 200
C
  200   PRINT 201
  201   FORMAT(' PRINT THE SPECIES')
	READ 30, VNAME2
C
	IF(VNAME2.EQ.'na') GO TO 221
	IF(VNAME2.EQ.'k') GO TO 222
	IF(VNAME2.EQ.'cl') GO TO 223
	IF(VNAME2.EQ.'hco3') GO TO 224
	IF(VNAME2.EQ.'h2co3') GO TO 225
	IF(VNAME2.EQ.'co2') GO TO 226
	IF(VNAME2.EQ.'hpo4') GO TO 227
	IF(VNAME2.EQ.'h2po4') GO TO 228
	IF(VNAME2.EQ.'urea') GO TO 229
	IF(VNAME2.EQ.'nh3') GO TO 230
	IF(VNAME2.EQ.'nh4') GO TO 231
	IF(VNAME2.EQ.'hco2') GO TO 232
	IF(VNAME2.EQ.'h2co2') GO TO 233
	IF(VNAME2.EQ.'gluc') GO TO 234
C
C
  221   IWR(KWR)=IWR(KWR)+0
	GO TO 700
  222   IWR(KWR)=IWR(KWR)+1
	GO TO 700
  223   IWR(KWR)=IWR(KWR)+2
	GO TO 700
  224   IWR(KWR)=IWR(KWR)+3
	GO TO 700
  225   IWR(KWR)=IWR(KWR)+4
	GO TO 700
  226   IWR(KWR)=IWR(KWR)+5
	GO TO 700
  227   IWR(KWR)=IWR(KWR)+6
	GO TO 700
  228   IWR(KWR)=IWR(KWR)+7
	GO TO 700
  229   IWR(KWR)=IWR(KWR)+8
	GO TO 700
  230   IWR(KWR)=IWR(KWR)+9
	GO TO 700
  231   IWR(KWR)=IWR(KWR)+10
	GO TO 700
  232   IWR(KWR)=IWR(KWR)+11
	GO TO 700
  233   IWR(KWR)=IWR(KWR)+12
	GO TO 700
  234   IWR(KWR)=IWR(KWR)+13
	GO TO 700
C
  700   PRINT 710
  710   FORMAT(' VARIABLE INCREMENT=',$)
	READ *, VINCR(KWR)
C
  800   CONTINUE
  801   CONTINUE
C
C
C BOUNDARY VALUES,ACTIVE TRANSPORT,AND THE TIME INCREMENT ARE
C READ. THE TIME STEP WILL CYCLE FROM THIS POINT.
C
	READ(19,50) DT,VM,PM,IMPM,VS,PS,IMPS,
     1  (CM(I),CS(I),I=1,11),(CM(I),CS(I),I=13,SOLS)
   50   FORMAT (D12.4,/,6F8.4,/,(2F14.9))
C
	PRINT 60
   60   FORMAT(' TLIM=',$)
	READ *, TLIM
C
C	1-	NA+
C	2-	K+
C	3-	CL-
C	4-	HCO3-
C	5-	H2CO3
C	6-	CO2
C	7-	HPO4--
C	8-	H2PO4-
C	9-	UREA
C	10-	NH3
C	11-	NH4+
C	12-	H+
C	13-	HCO2-
C	14-	H2CO2
C	15-	GLUC-
C
C CHECK EQUILIBRIUM BETWEEN DISSOLVED CO2 AND H2CO3
C
	PRINT 120
  120   FORMAT('Assumed equilibrium pH? (y/n)  ',$)
	READ *, SWEQ
C
	DO 900 K=1,TLIM
C
	IF (SWEQ.EQ.'n') GO TO 122
	CM(5)=CM(6)/KCO2
	CS(5)=CS(6)/KCO2
C
  122   LCHM=PKC + DLOG10(CM(4)/CM(5))
	LCHS=PKC + DLOG10(CS(4)/CS(5))
C
	TPM=CM(7)+CM(8)
	TNM=CM(10)+CM(11)
	TFM=CM(13)+CM(14)
	TPS=CS(7)+CS(8)
	TNS=CS(10)+CS(11)
	TFS=CS(13)+CS(14)
C
	QPM=10.**(LCHM-PKP)
	QNM=10.**(LCHM-PKN)
	QFM=10.**(LCHM-PKF)
	QPS=10.**(LCHS-PKP)
	QNS=10.**(LCHS-PKN)
	QFS=10.**(LCHS-PKF)
C
	CM(8)=TPM/(1.+QPM)
	CM(7)=TPM-CM(8)
	CM(11)=TNM/(1.+QNM)
	CM(10)=TNM-CM(11)
	CM(14)=TFM/(1.+QFM)
	CM(13)=TFM-CM(14)
C
	CS(8)=TPS/(1.+QPS)
	CS(7)=TPS-CS(8)
	CS(11)=TNS/(1.+QNS)
	CS(10)=TNS-CS(11)
	CS(14)=TFS/(1.+QFS)
	CS(13)=TFS-CS(14)
C
	CM(3)=IMPM*ZIMPM + CM(1)*Z(1) + CM(2)*Z(2)
	CS(3)=IMPS*ZIMPS + CS(1)*Z(1) + CS(2)*Z(2)
	DO 130 I=4,SOLS
	CM(3)=CM(3)+CM(I)*Z(I)
	CS(3)=CS(3)+CS(I)*Z(I)
  130   CONTINUE
C
	WRITE (22,150) DT,VM,PM,IMPM,VS,PS,IMPS,
     1  (CM(I),CS(I),I=1,11),(CM(I),CS(I),I=13,SOLS)
  150   FORMAT (D12.4,/,6F8.4,/,(2F14.9))
C
C
	IF(NWR.EQ.0) GO TO 145
	DO 140 KWR=1,NWR
	VMAT(IWR(KWR),JWR(KWR))=VMAT(IWR(KWR),JWR(KWR))+VINCR(KWR)
  140   CONTINUE
  145   CONTINUE
C
  900   CONTINUE
	STOP
	END
