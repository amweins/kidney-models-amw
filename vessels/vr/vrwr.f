	PROGRAM VRWR
C  PROGRAM TO READ AN OUTPUT FILE FROM VR.F
C
	INTEGER NWR,IWR(20),JWR(20),CHOP(7),DCHOP(7),
     1   NSEG
	REAL WRRES(3601,200),CL,RDRES(3601,20)
        CHARACTER*12 IPTFIL,OPTFIL,VARNAM
        CHARACTER*8 VNAME1(20),VNAME2(20),SWI,SWO,SWF
	CHARACTER*5 SEGNAMOM(2),SEGNAMIM(4),SEGNAMMR(2)
	CHARACTER*2 SWVR
C	SWVR-	DIRECTING THE CALCULATION TO OM, IM, or MR VESSELS
C
	COMMON/TWR/NWR,IWR,JWR,RDRES
	DATA SEGNAMOM /'OMDVR','OMAVR'/
	DATA SEGNAMIM /'OIDVR','IMDVR','IMAVR','OIAVR'/
	DATA SEGNAMMR /'MRDVR','MRAVR'/
C
	PRINT 2
    2   FORMAT(' TYPE THE INPUT FILENAME:',$)
	READ 4, IPTFIL
    4   FORMAT(A12)
	PRINT 6
    6   FORMAT(' TYPE THE OUTPUT FILENAME:',$)
	READ 4, OPTFIL
	OPEN(1,FILE=IPTFIL)
	OPEN(2,FILE=OPTFIL)
C
	PRINT 10
   10   FORMAT(' Outer Medulla, Inner Medulla, or Medullary Ray
     1    (om/im/mr): ',$)
	READ *, SWVR
	IF (SWVR.EQ.'om') THEN
	NSEG=2
	OPEN(4,FILE='vrmeshom.dat')
	ELSE IF (SWVR.EQ.'im') THEN
	NSEG=4
	OPEN(4,FILE='vrmeshim.dat')
	ELSE IF (SWVR.EQ.'mr') THEN
	NSEG=2
	OPEN(4,FILE='vrmeshmr.dat')
        ELSE
	PRINT 18
   18   FORMAT (' NO VESSEL SELECTED')
	STOP
	ENDIF
C
	PRINT 3
    3   FORMAT(' MESH SPACING - DATA FILE OR INTERACTIVE? (d/i):',$)
	READ *, SWI
	IF (SWI.EQ.'i') GO TO 7
	READ (4,5) (CHOP(L),DCHOP(L),L=1,NSEG)
    5   FORMAT(2I5)
	GO TO 12
C
    7   DO 11 K=1,NSEG
	IF (SWVR.EQ.'om') THEN
	PRINT 8, SEGNAMOM(K)
	ELSE IF (SWVR.EQ.'im') THEN
	PRINT 8, SEGNAMIM(K)
	ELSE IF (SWVR.EQ.'mr') THEN
	PRINT 8, SEGNAMMR(K)
	ENDIF
    8   FORMAT(A4,' SPATIAL CHOP, AND PRINT SPACING:',$) 
	READ *, CHOP(K),DCHOP(K)
   11   CONTINUE
C
   12   DO 13 L=1,NSEG
   13   CHOP(L)=CHOP(L)+1
C
	IWR(1)=1
	JWR(1)=1
C
	PRINT 500
  500   FORMAT(' IS INPUT FROM A DATA FILE OR INTERACTIVE? (d/i): ',$)
	READ 30, SWI
  510   IF (SWI.EQ.'i') GO TO 15
	PRINT 516
  516   FORMAT(' TYPE THE VARIABLE FILENAME:',$)
	READ 4, VARNAM
	OPEN(3,FILE=VARNAM)
	READ (3,515) NWR
  515   FORMAT(3X,I2)
	DO 525 KWR=2,NWR+1
  525   READ (3,530) VNAME1(KWR),VNAME2(KWR)
  530   FORMAT(2A8)
	GO TO 801
C
C
   15   PRINT 16
   16   FORMAT(' TYPE THE NUMBER OF VARIABLES TO BE REWRITTEN')
	READ *, NWR
	DO 50 KWR=2,NWR+1
	PRINT 20, KWR-1
   20   FORMAT(' TYPE THE NAME OF VARIABLE NUMBER-',I2)
	READ 30, VNAME1(KWR)
   30   FORMAT(A8)
	IF(VNAME1(KWR).EQ.'cs') GO TO 40
	IF(VNAME1(KWR).EQ.'cc') GO TO 40
	IF(VNAME1(KWR).EQ.'xc') GO TO 40
	IF(VNAME1(KWR).EQ.'fkc') GO TO 40
	IF(VNAME1(KWR).EQ.'fkcs') GO TO 40
	GO TO 50
C
   40   PRINT 45
   45   FORMAT(' TYPE THE SPECIES')
	READ 30, VNAME2(KWR)
   50   CONTINUE
C
C THE WRITTEN VARIABLES HAVE BEEN SPECIFIED, AS HAS TUBULE SEGMENTATION
C
  801   CL=0.0
	DO 900 KXP=1,100
C
C DATA FOR EACH SEGMENT IS READ
C
	ISEG=0
	DO 820 KSEG=1,NSEG
	DO 810 KWR=2,NWR+1
  810   CALL SELEC 
     1   (VNAME1(KWR),VNAME2(KWR),IWR(KWR),JWR(KWR),CHOP(KSEG))
	CALL RDSEG(CHOP(KSEG),*811,*901)
  811   IF (KXP.GT.1) GO TO 815
	DO 812 I=1,CHOP(KSEG)
  812   WRRES(I+ISEG,1)=RDRES(I,1)
  815   DO 817 J=2,NWR+1
	DO 817 I=1,CHOP(KSEG)
  817   WRRES(I+ISEG,J+(KXP-1)*NWR)=RDRES(I,J)
	ISEG=ISEG+CHOP(KSEG)
  820   CONTINUE
C	
  900   CONTINUE
C
C WRRES HAS BEEN FILLED. DISTANCE IS BY ROW, AND VALUE ACROSS THE COLUMNS.
C
  901   KXP=KXP-1
	PRINT 909
  909   FORMAT(' FULL CD PROFILE OR JUST FINAL URINE? (x/u): ',$)
	READ *, SWO
	IF (SWO.EQ.'u') GO TO 950
C
C ALLOW FOLDING OF THE BLOOD VESSEL, SO THAT END-AVR IS BACK AT X=0.
C
	PRINT 870
  870   FORMAT(' STRAIGHT-THROUGH OR FOLDED VESSELS? (t/f): ',$)
	READ *, SWF
	IF (SWF.EQ.'t') GO TO 902
C
C ALLOW FOLDING OF THE BLOOD VESSEL, SO THAT END-AVR IS BACK AT X=0.
C
        NROW = CHOP(1)
        DO 880 KSEG=2,NSEG
  880   NROW = NROW + CHOP(KSEG)
C
        DO 890 I=1,NROW/2
  890   WRRES(NROW-I+1,1)=WRRES(I,1)
C
  902   ISEG=0
	DO 920 KSEG=1,NSEG
	DO 910 I=1+ISEG,ISEG+CHOP(KSEG),DCHOP(KSEG)
  910   WRITE (2,905) (WRRES(I,J),J=1,KXP*NWR+1)
  905   FORMAT (8E16.8)
	ISEG=ISEG+CHOP(KSEG)
  920   CONTINUE
	STOP
C
  950   DO 951 KSEG=1,NSEG
	ISEG=ISEG+CHOP(KSEG)
  951   CONTINUE
	DO 955 K=1,KXP
  955   WRITE (2,905) (WRRES(ISEG,J),J=2 + (K-1)*NWR, 1 + K*NWR)
C
	STOP
	END
C
C
        SUBROUTINE SELEC (VNAME1,VNAME2,IWR,JWR,IC)
C
	INTEGER NWR,IWR,JWR,IC
        CHARACTER*8 VNAME1,VNAME2
C
C
	IF(VNAME1.EQ.'vc') THEN 
        IWR=1+2*IC
        JWR=2
        GO TO 800
        ELSE IF(VNAME1.EQ.'pc') THEN 
        IWR=1+IC
        JWR=2
        GO TO 800
        ELSE IF(VNAME1.EQ.'cc') THEN 
        IWR=1+IC
        JWR=3
        GO TO 200
	ELSE IF(VNAME1.EQ.'phc') THEN 
        IWR=1+2*IC
        JWR=13
        GO TO 800
	ELSE IF(VNAME1.EQ.'xc') THEN 
        IWR=1+2*IC
        JWR=3
        GO TO 200
	ELSE IF(VNAME1.EQ.'fvc') THEN 
        IWR=1+3*IC
	JWR=2
        GO TO 800
	ELSE IF(VNAME1.EQ.'fkc') THEN 
        IWR=1+3*IC
	JWR=3
        GO TO 200
	ELSE IF(VNAME1.EQ.'fbc') THEN 
        IWR=1+3*IC
	JWR=13
        GO TO 800
	ELSE IF(VNAME1.EQ.'hct') THEN 
        IWR=1+3*IC
	JWR=14
        GO TO 800
C
	ELSE IF(VNAME1.EQ.'ps') THEN 
        IWR=1
	JWR=2
        GO TO 800
	ELSE IF(VNAME1.EQ.'cs') THEN 
        IWR=1
	JWR=3
        GO TO 200
	ELSE IF(VNAME1.EQ.'phs') THEN 
        IWR=1
	JWR=13
        GO TO 800
	ELSE IF(VNAME1.EQ.'fvcs') THEN 
        IWR=2+4*IC
	JWR=2
        GO TO 800
	ELSE IF(VNAME1.EQ.'fkcs') THEN 
        IWR=2+4*IC
	JWR=3
        GO TO 200
C
	ELSE IF(VNAME1.EQ.'apr') THEN 
        IWR=1+4*IC
	JWR=2
        GO TO 200
	ELSE IF(VNAME1.EQ.'cur') THEN 
        IWR=2+4*IC
	JWR=13
        GO TO 800
	ELSE IF(VNAME1.EQ.'h') THEN 
        IWR=2+5*IC
	JWR=3
        GO TO 800
	ELSE IF(VNAME1.EQ.'hgb') THEN 
        GO TO 250
        ELSE
        PRINT 40
   40   FORMAT(' NO SUCH VARIABLE NAME, TRY AGAIN')
        STOP
        ENDIF
C
C
  200   CONTINUE
	IF(VNAME2.EQ.'vol') THEN 
        JWR=JWR-1
	GO TO 800
	ELSE IF(VNAME2.EQ.'na') THEN 
        JWR=JWR+0
	GO TO 800
	ELSE IF(VNAME2.EQ.'k') THEN 
        JWR=JWR+1
	GO TO 800
	ELSE IF(VNAME2.EQ.'cl') THEN 
        JWR=JWR+2
	GO TO 800
	ELSE IF(VNAME2.EQ.'hco3') THEN 
        JWR=JWR+3
	GO TO 800
	ELSE IF(VNAME2.EQ.'hpo') THEN 
        JWR=JWR+4
	GO TO 800
	ELSE IF(VNAME2.EQ.'h2po') THEN 
        JWR=JWR+5
	GO TO 800
	ELSE IF(VNAME2.EQ.'urea') THEN 
        JWR=JWR+6
	GO TO 800
	ELSE IF(VNAME2.EQ.'nh4') THEN 
        JWR=JWR+7
	GO TO 800
	ELSE IF(VNAME2.EQ.'hco2') THEN 
        JWR=JWR+8
	GO TO 800
	ELSE IF(VNAME2.EQ.'gluc') THEN 
        JWR=JWR+9
	GO TO 800
	ELSE IF(VNAME2.EQ.'prot') THEN 
        JWR=13
	GO TO 800
	ELSE IF(VNAME2.EQ.'osms') THEN 
        JWR=14
	GO TO 800
	ELSE IF(VNAME2.EQ.'impc') THEN 
        JWR=14
	GO TO 800
	ELSE IF(VNAME2.EQ.'osmc') THEN 
        IWR=1+2*IC
        JWR=13
	GO TO 800
        ELSE IF(VNAME2.EQ.'ta') THEN
        JWR=11
          IF(VNAME1.EQ.'cc') THEN
          IWR=2+5*IC
	  GO TO 800
          ELSE IF(VNAME1.EQ.'fkc') THEN
          IWR=2+6*IC
	  GO TO 800
          ELSE IF(VNAME1.EQ.'apr') THEN
          JWR=13
	  GO TO 800
          ELSE
          PRINT 235
  235     FORMAT(' CANT FIND VNAME1 MATCHING TA, TRY AGAIN')
            STOP
          ENDIF
        ELSE IF(VNAME2.EQ.'nae') THEN
        JWR=12
          IF(VNAME1.EQ.'cc') THEN
          IWR=2+5*IC
	  GO TO 800
          ELSE IF(VNAME1.EQ.'fkc') THEN
          IWR=2+6*IC
	  GO TO 800
          ELSE IF(VNAME1.EQ.'apr') THEN
          JWR=14
	  GO TO 800
          ELSE
          PRINT 236
  236     FORMAT(' CANT FIND VNAME1 MATCHING NAE, TRY AGAIN')
            STOP
          ENDIF
        ELSE
        PRINT 240
  240   FORMAT(' NO SUCH SOLUTE NAME, TRY AGAIN')
        STOP
        ENDIF
C
C
C A HGB SPECIES HAS BEEN DESIGNATED
C
  250   CONTINUE
	IF(VNAME2.EQ.'onh2') THEN 
        IWR=2+5*IC
        JWR=4
	GO TO 800
	ELSE IF(VNAME2.EQ.'nh2') THEN 
        IWR=2+5*IC
        JWR=5
	GO TO 800
	ELSE IF(VNAME2.EQ.'onh3') THEN 
        IWR=2+5*IC
        JWR=6
	GO TO 800
	ELSE IF(VNAME2.EQ.'nh3') THEN 
        IWR=2+5*IC
        JWR=7
	GO TO 800
	ELSE IF(VNAME2.EQ.'onhco2') THEN 
        IWR=2+5*IC
        JWR=8
	GO TO 800
	ELSE IF(VNAME2.EQ.'nhco2') THEN 
        IWR=2+5*IC
        JWR=9
	GO TO 800
	ELSE IF(VNAME2.EQ.'oxh') THEN 
        IWR=2+5*IC
        JWR=2
	GO TO 800
	ELSE IF(VNAME2.EQ.'xh') THEN 
        IWR=2+6*IC
        JWR=3
	GO TO 800
	ELSE IF(VNAME2.EQ.'ox') THEN 
        IWR=2+6*IC
        JWR=4
	GO TO 800
	ELSE IF(VNAME2.EQ.'x') THEN 
        IWR=2+6*IC
        JWR=5
	GO TO 800
	ELSE IF(VNAME2.EQ.'oyh') THEN 
        IWR=2+6*IC
        JWR=6
	GO TO 800
	ELSE IF(VNAME2.EQ.'yh') THEN 
        IWR=2+6*IC
        JWR=7
	GO TO 800
	ELSE IF(VNAME2.EQ.'oy') THEN 
        IWR=2+6*IC
        JWR=8
	GO TO 800
	ELSE IF(VNAME2.EQ.'y') THEN 
        IWR=2+6*IC
        JWR=9
	GO TO 800
        ELSE
        PRINT 260
  260   FORMAT(' NO SUCH HGB NAME, TRY AGAIN')
        STOP
        ENDIF
C
  800   RETURN
        END
C
C
	SUBROUTINE RDSEG(CHOP,*,*)
C PROGRAM TO READ THE TUBULE SEGMENT RECORDS AND OUTPUT THE SELECTED VARIABLES
C
	INTEGER NWR,IWR(20),JWR(20),CHOP
	REAL RES(4803,16),TIME,RDRES(3601,20)
C
	COMMON/TWR/NWR,IWR,JWR,RDRES
C
        IC = CHOP
C
  300   READ (1,310,END=360) TIME
  310   FORMAT (2(/),11X,F15.4)
	READ (1,325) ((RES(I,J),J=1,14),I=1,IC)
	READ (1,325) ((RES(I,J),J=1,14),I=1+IC,2*IC)
	READ (1,320) ((RES(I,J),J=1,13),I=1+2*IC,3*IC)
C
	READ (1,325) ((RES(I,J),J=1,14),I=1+3*IC,4*IC)
	READ (1,335) (RES(1+4*IC,J),J=2,14)
	READ (1,340) ((RES(I,J),J=1,13),I=2+4*IC,1+5*IC)
	READ (1,345) 
     1   ((RES(I,J),J=1,9),RES(I,11),RES(I,12),I=2+5*IC,1+6*IC)
	READ (1,350) 
     1   ((RES(I,J),J=1,9),RES(I,11),RES(I,12),I=2+6*IC,1+7*IC)
  320   FORMAT (///,(3X,F8.6,12F11.6))
  325   FORMAT (///,(3X,F8.6,13F11.6))
  330   FORMAT (///,(3X,F8.6,12F11.6))
  335   FORMAT (//,(11X,13F11.6))
  340   FORMAT (///,(3X,F8.6,12D11.3))
  345   FORMAT (6(/),(3X,F8.6,F10.6,D12.4,6F11.6,11X,2F11.6))
  350   FORMAT (///,(3X,F8.6,8F11.6,11X,2F11.6))
C
	DO 349 I=1,CHOP
  349   RDRES(I,1)=RES(I,1)
	DO 355 J=2,NWR+1
	DO 355 I=1,CHOP
  355   RDRES(I,J)=RES(IWR(J)+I-1,JWR(J))
C
	RETURN 1
  360   RETURN 2
	END
C
