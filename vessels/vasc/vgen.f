	SUBROUTINE VGEN
C
C PROGRAM TO SUM THE NEXT EXPORT OF VOLUME AND SOLUTE AT EACH MEDULLARY LEVEL
C  SINCE THERE IS A CONING OF VESSELS THE PROGRAM TRANSFORMS 2-D DATA TO A VECTOR
C
C THE ARCHIVED DATA CONTAINS FLOWS/FLUXES FOR SOLITARY VESSELS -
C   THIS MUST BE SCALED UP ACCORDING TO VESSEL NUMBER
C
C KEY TO INDICES:
C  8 vessels: OM (IVR = 1,2) plus 5 IM (IVR = 3-7), plus 1 MR (IVR = 8)
C
C Segment numbers (ISEG)
C      1- OMDVR, MRDVR, OIDVR
C      2- IMDVR
C      3- IMAVR
C      4- OMAVR, MRAVR, OIAVR
C
        DOUBLE PRECISION RADVR(8),RDNUM(8),RANUM(8)
C  RADVR- RATIO OF AVR NUMBER TO DVR NUMBER FOR EACH VESSEL
C  RDNUM- ABSOLUTE NUMBER OF DVR FOR EACH VR INDEX
C  RANUM- AVSOLUTE NUMBER OF AVR FOR EACH VR INDEX
C
	INTEGER 
     1   RVX(8,4), RVCHOP(8,4)
C PARAMETERS
	DOUBLE PRECISION
     1   RVEPSI(8,4),RVDIST(8,4),RVKHY(8,4),RVKDHY(8,4),
     1   RVDX(8,4),RVETA(8,4),RCL(8,4),RRC0(8,4),RMUC(8,4),
     1   RLPCS(8,4),RSCS(8,4,15),RLCS(8,4,15),RHCS(8,4,15),
     1   RLPCSE(8,4),RSCSE(8,4,15),RLCSE(8,4,15),RHCSE(8,4,15),
     1   RLPCSI(8,4),RSCSI(8,4,15),RLCSI(8,4,15),RHCSI(8,4,15)
C VARIABLES
	DOUBLE PRECISION
     1   RVVS(8,4,901,2),RVPS(8,4,901,2),RVCS(8,4,16,901,2),
     1   RVIMPS(8,4,901,2),RVLCHS(8,4,901),RVXS(8,4,15,901),
     1   RVC(8,4,901,2),RPC(8,4,901,2),RCC(8,4,31,901,2),
     1   RIMPC(8,4,901,2),RLCHC(8,4,901),RXC(8,4,15,901),
     1   RSAT(8,4,901,2),RCCN(8,4,901,2),
     1   RCCX(8,4,901,2),RCCY(8,4,901,2),RPOX(8,4,901,2),
     1   RSC(8,4,901,2),RAC(8,4,901,2),RFVC(8,4,901,2),
     1   RFKC(8,4,31,901,2),RFVCS(8,4,901,2),RFKCS(8,4,16,901,2),
     1   RFVCSE(8,4,901,2),RFKCSE(8,4,16,901,2),RFVCSI(8,4,901,2),
     1   RFKCSI(8,4,16,901,2),RHCTC(8,4,901,2),RFBC(8,4,901,2)
C
	INTEGER SOLS,CHOP,OMCHOP,IMCHOP,MRCHOP
C
        DOUBLE PRECISION
     1    OMDIST(901),OMJVCS(901),OMJKCS(16,901),
     1    IMDIST(901),IMJVCS(901),IMJKCS(16,901),
     1    MRDIST(901),MRJVCS(901),MRJKCS(16,901),
     1    MEDJVCS(7),MEDJKCS(16,7),DX,TJV,TJKCS(16),
     1    TV(10),TK(10,16),SEGV(8,4),SEGK(8,4,16),
     1    VRV(8),VRK(8,16),SLV(2),SLK(2,16)
C
        CHARACTER*8 SOL(16)
C
C VARIABLES LOCAL TO THIS SUBROUTINE:
C       DIST-  MEDULLARY DEPTH
C       JVCS-  TOTAL VOLUME FLUX FROM VR TO IS        
C       JKCS-  TOTAL SOLUTE FLUX FROM VR TO IS
C       MEDJCS-SUMMATION OF FLUXES FOR EACH MM SLICE OF MEDULLA OM->TIP
C       TJJCS- SUMMATION OF THE MEDJCS ACROSS ALL SLICES
C       TJV,TJK-    TRANSPORT ACCORDING TO VESSEL (RATHER THAN SLICE)
C       SEGV,SEGK-  SEGMENTAL FLUX SUMS; COMPONENTS OF JVCS AND JKCS:
C           OMJCS = SUM(SEG(I,1) + SEG(I,4)), I=1,7
C           IMJCS = SUM(SEG(I,2) + SEG(I,3)), I=3,7
C       VRV,VRK-  VESSEL FLUXES SUMMED FROM THE SEGV AND SEGK VARIABLES
C       SLV,SLK-  OM (K=1) AND IM (K=2) FLUXES SUMMED FROM SEGV AND SEGK
C
	COMMON /ARCHVR/
     1   RVX,RVCHOP,RADVR,RDNUM,RANUM,
     1   RVEPSI,RVDIST,RVKHY,RVKDHY,
     1   RVDX,RVETA,RCL,RRC0,RMUC,
     1   RLPCS,RSCS,RLCS,RHCS,
     1   RLPCSE,RSCSE,RLCSE,RHCSE,
     1   RLPCSI,RSCSI,RLCSI,RHCSI,
     1   RVVS,RVPS,RVCS,RVIMPS,RVLCHS,RVXS,
     1   RVC,RPC,RCC,RIMPC,RLCHC,RXC,
     1   RSAT,RCCN,RCCX,RCCY,RSC,RAC,
     1   RFVC,RFKC,RFVCS,RFKCS,
     1   RFVCSE,RFKCSE,RFVCSI,
     1   RFKCSI,RHCTC,RFBC,RPOX
C	
        DATA 
     1   OMJVCS/901*0.D0/,OMJKCS/14416*0.D0/,
     1   IMJVCS/901*0.D0/,IMJKCS/14416*0.D0/,
     1   MRJVCS/901*0.D0/,MRJKCS/14416*0.D0/,
     1   MEDJVCS/7*0.D0/,MEDJKCS/112*0.D0/,
     1   SEGV/32*0.D0/,SEGK/512*0.D0/
C
C VASA RECTA INDEX (IVR)
C  SDVR -> SAVR (1,2)
C  LDVR(OM) -> LDVR(IM) -> LAVR(IM) -> LAVR(OM) (3,7)
C  MRDVR -> MRAVR (8)
C
C  In all, there are 4 short vessel segments, 20 long vessel segments,
C     and 2 MR vessel segments = 26.
C  In will be read as named data in anticipation for processing.
C
C Segment numbers (ISEG)
C      1- OMDVR,OIDVR,MRDVR
C      2- IMDVR
C      3- IMAVR
C      4- OMAVR,OIAVR,MRAVR
C
C PROGRAM TO CONSOLIDATE THE VR INTO FULL MEDULLARY VASCULATURE 
C Plan for 36000 OMDVR = 24000 sDVR + 12000 lDVR ~ about 3x JM glomeruli
C           7200 MRDVR (DVR from 24000 SF glom = 72000, so this is 10%)  
C Plan for 72000 OMAVR, 24000 IMAVR, 14400 MRAVR; AVR are 2x the DVR number
C  OM and IM DVR derive from 12000 JM nephrons; MR DVR from 2400 SF nephrons
C  Of the IM vessels, turns parallel those of the nephron
C         IMDVR       IMAVR
C    1 mm  6000       12000
C    2 mm  3000        6000
C    3 mm  1500        3000
C    4 mm   750        1500
C    5 mm   375         750
C
C
        SOLS = 15
	SOL(1)='  NA '
	SOL(2)='  K  '
	SOL(3)='  CL '
	SOL(4)=' HCO3'
	SOL(5)='H2CO3'
	SOL(6)=' CO2 '
	SOL(7)=' HPO4'
	SOL(8)='H2PO4'
	SOL(9)=' UREA'
	SOL(10)=' NH3 '
	SOL(11)=' NH4+'
	SOL(12)='  H+ '
	SOL(13)='HCO2-'
	SOL(14)='H2CO2'
	SOL(15)=' GLUC'
	SOL(16)=' PROT'
C
C THE SUMMATIONS BELOW FIRST INTEGRATE OVER SEGMENT NUMBER TO GET
C  NET INTERSTITIAL FLUXES AT EACH POINT X: OMJCS(SOL,X) OR IMJCS(SOL,X)
C THEN THEY SUM OVER X WITHIN A SLICE: MEDJCS(SOL,SLICE)
C  TO DEBUG: FIRST PRESERVE THE SEGMENTAL INTEGRITY, TO COMPARE WITH VASCWR
C
C OUTER MEDULLA
C
        ISEG=1
        IVR=2
        CHOP=RVCHOP(IVR,ISEG)
        OMDIST(1) = 0.0
	DO 110 KX=2,CHOP+1
  110   OMDIST(KX) = OMDIST(KX-1) + RCL(IVR,ISEG)/FLOAT(CHOP)
        OMCHOP=CHOP
C
C - DESCENDING
C
        ISEG=1
        IVR=1
        CHOP=RVCHOP(IVR,ISEG)
        DO 120 IX=1,CHOP+1
        OMJVCS(IX)=OMJVCS(IX)+
     1    RDNUM(IVR)*RSC(IVR,ISEG,IX,1)*RFVCS(IVR,ISEG,IX,1)
        DO 119 ISOL=1,SOLS
  119   OMJKCS(ISOL,IX)=OMJKCS(ISOL,IX)+
     1    RDNUM(IVR)*RSC(IVR,ISEG,IX,1)*RFKCS(IVR,ISEG,ISOL,IX,1)
  120   CONTINUE
C
        DX=RCL(IVR,ISEG)/FLOAT(RVCHOP(IVR,ISEG))
        DO 125 IX=1,CHOP
        SEGV(IVR,ISEG)=SEGV(IVR,ISEG)+
     1    0.5*DX*(RDNUM(IVR)*RSC(IVR,ISEG,IX,1)*
     1       RFVCS(IVR,ISEG,IX,1))+
     1    0.5*DX*(RDNUM(IVR)*RSC(IVR,ISEG,IX+1,1)*
     1       RFVCS(IVR,ISEG,IX+1,1))
        DO 124 ISOL=1,SOLS
  124   SEGK(IVR,ISEG,ISOL)=SEGK(IVR,ISEG,ISOL)+
     1    0.5*DX*(RDNUM(IVR)*RSC(IVR,ISEG,IX,1)*
     1       RFKCS(IVR,ISEG,ISOL,IX,1))+
     1    0.5*DX*(RDNUM(IVR)*RSC(IVR,ISEG,IX+1,1)*
     1       RFKCS(IVR,ISEG,ISOL,IX+1,1))
  125   CONTINUE
C
        CHOP=OMCHOP
        DO 140 IVR=2,7
        DO 130 IX=1,CHOP+1
        OMJVCS(IX)=OMJVCS(IX)+
     1    RDNUM(IVR)*RSC(IVR,ISEG,IX,1)*RFVCS(IVR,ISEG,IX,1)
        DO 129 ISOL=1,SOLS
  129   OMJKCS(ISOL,IX)=OMJKCS(ISOL,IX)+
     1    RDNUM(IVR)*RSC(IVR,ISEG,IX,1)*RFKCS(IVR,ISEG,ISOL,IX,1)
  130   CONTINUE
  140   CONTINUE
C
        DO 145 IVR=2,7
        DX=RCL(IVR,ISEG)/FLOAT(RVCHOP(IVR,ISEG))
        DO 135 IX=1,CHOP
        SEGV(IVR,ISEG)=SEGV(IVR,ISEG)+
     1    0.5*DX*(RDNUM(IVR)*RSC(IVR,ISEG,IX,1)*
     1       RFVCS(IVR,ISEG,IX,1))+
     1    0.5*DX*(RDNUM(IVR)*RSC(IVR,ISEG,IX+1,1)*
     1       RFVCS(IVR,ISEG,IX+1,1))
        DO 134 ISOL=1,SOLS
  134   SEGK(IVR,ISEG,ISOL)=SEGK(IVR,ISEG,ISOL)+
     1    0.5*DX*(RDNUM(IVR)*RSC(IVR,ISEG,IX,1)*
     1       RFKCS(IVR,ISEG,ISOL,IX,1))+
     1    0.5*DX*(RDNUM(IVR)*RSC(IVR,ISEG,IX+1,1)*
     1       RFKCS(IVR,ISEG,ISOL,IX+1,1))
  135   CONTINUE
  145   CONTINUE
C
C - ASCENDING
C
        ISEG=4
        IVR=1
        CHOP=RVCHOP(IVR,ISEG)
        DO 150 IX=1,CHOP+1
        OMJVCS(CHOP+2-IX)=OMJVCS(CHOP+2-IX)+
     1    RANUM(IVR)*RSC(IVR,ISEG,IX,1)*RFVCS(IVR,ISEG,IX,1)
        DO 149 ISOL=1,SOLS
  149   OMJKCS(ISOL,CHOP+2-IX)=OMJKCS(ISOL,CHOP+2-IX)+
     1    RANUM(IVR)*RSC(IVR,ISEG,IX,1)*RFKCS(IVR,ISEG,ISOL,IX,1)
  150   CONTINUE
C
        DX=RCL(IVR,ISEG)/FLOAT(RVCHOP(IVR,ISEG))
        DO 155 IX=1,CHOP
        SEGV(IVR,ISEG)=SEGV(IVR,ISEG)+
     1    0.5*DX*(RANUM(IVR)*RSC(IVR,ISEG,IX,1)*
     1       RFVCS(IVR,ISEG,IX,1))+
     1    0.5*DX*(RANUM(IVR)*RSC(IVR,ISEG,IX+1,1)*
     1       RFVCS(IVR,ISEG,IX+1,1))
        DO 154 ISOL=1,SOLS
  154   SEGK(IVR,ISEG,ISOL)=SEGK(IVR,ISEG,ISOL)+
     1    0.5*DX*(RANUM(IVR)*RSC(IVR,ISEG,IX,1)*
     1       RFKCS(IVR,ISEG,ISOL,IX,1))+
     1    0.5*DX*(RANUM(IVR)*RSC(IVR,ISEG,IX+1,1)*
     1       RFKCS(IVR,ISEG,ISOL,IX+1,1))
  155   CONTINUE
C
        CHOP=OMCHOP
        DO 170 IVR=2,7
        DO 160 IX=1,CHOP+1
        OMJVCS(CHOP+2-IX)=OMJVCS(CHOP+2-IX)+
     1    RANUM(IVR)*RSC(IVR,ISEG,IX,1)*RFVCS(IVR,ISEG,IX,1)
        DO 159 ISOL=1,SOLS
  159   OMJKCS(ISOL,CHOP+2-IX)=OMJKCS(ISOL,CHOP+2-IX)+
     1    RANUM(IVR)*RSC(IVR,ISEG,IX,1)*RFKCS(IVR,ISEG,ISOL,IX,1)
  160   CONTINUE
  170   CONTINUE
C
        DO 175 IVR=2,7
        DX=RCL(IVR,ISEG)/FLOAT(RVCHOP(IVR,ISEG))
        DO 165 IX=1,CHOP
        SEGV(IVR,ISEG)=SEGV(IVR,ISEG)+
     1    0.5*DX*(RANUM(IVR)*RSC(IVR,ISEG,IX,1)*
     1       RFVCS(IVR,ISEG,IX,1))+
     1    0.5*DX*(RANUM(IVR)*RSC(IVR,ISEG,IX+1,1)*
     1       RFVCS(IVR,ISEG,IX+1,1))
        DO 164 ISOL=1,SOLS
  164   SEGK(IVR,ISEG,ISOL)=SEGK(IVR,ISEG,ISOL)+
     1    0.5*DX*(RANUM(IVR)*RSC(IVR,ISEG,IX,1)*
     1       RFKCS(IVR,ISEG,ISOL,IX,1))+
     1    0.5*DX*(RANUM(IVR)*RSC(IVR,ISEG,IX+1,1)*
     1       RFKCS(IVR,ISEG,ISOL,IX+1,1))
  165   CONTINUE
  175   CONTINUE
C
C INNER MEDULLA
C
        ISEG=2
        IVR=7
        CHOP=RVCHOP(IVR,ISEG)
        IMDIST(1) = OMDIST(OMCHOP+1)
	DO 210 KX=2,CHOP+1
  210   IMDIST(KX) = IMDIST(KX-1) + RCL(IVR,ISEG)/FLOAT(CHOP)
        IMCHOP=CHOP
C
C - DESCENDING
C
        DO 240 IVR=3,7
        CHOP=RVCHOP(IVR,ISEG)
        DO 230 IX=1,CHOP+1
        IMJVCS(IX)=IMJVCS(IX)+
     1    RDNUM(IVR)*RSC(IVR,ISEG,IX,1)*RFVCS(IVR,ISEG,IX,1)
        DO 229 ISOL=1,SOLS
  229   IMJKCS(ISOL,IX)=IMJKCS(ISOL,IX)+
     1    RDNUM(IVR)*RSC(IVR,ISEG,IX,1)*RFKCS(IVR,ISEG,ISOL,IX,1)
  230   CONTINUE
  240   CONTINUE
C
        DO 245 IVR=3,7
        DX=RCL(IVR,ISEG)/FLOAT(RVCHOP(IVR,ISEG))
        CHOP=RVCHOP(IVR,ISEG)
        DO 235 IX=1,CHOP
        SEGV(IVR,ISEG)=SEGV(IVR,ISEG)+
     1    0.5*DX*(RDNUM(IVR)*RSC(IVR,ISEG,IX,1)*
     1       RFVCS(IVR,ISEG,IX,1))+
     1    0.5*DX*(RDNUM(IVR)*RSC(IVR,ISEG,IX+1,1)*
     1       RFVCS(IVR,ISEG,IX+1,1))
        DO 234 ISOL=1,SOLS
  234   SEGK(IVR,ISEG,ISOL)=SEGK(IVR,ISEG,ISOL)+
     1    0.5*DX*(RDNUM(IVR)*RSC(IVR,ISEG,IX,1)*
     1       RFKCS(IVR,ISEG,ISOL,IX,1))+
     1    0.5*DX*(RDNUM(IVR)*RSC(IVR,ISEG,IX+1,1)*
     1       RFKCS(IVR,ISEG,ISOL,IX+1,1))
  235   CONTINUE
  245   CONTINUE
C
C - ASCENDING
C
        ISEG=3
        DO 270 IVR=3,7
        CHOP=RVCHOP(IVR,ISEG)
        DO 260 IX=1,CHOP+1
        IMJVCS(CHOP+2-IX)=IMJVCS(CHOP+2-IX)+
     1    RANUM(IVR)*RSC(IVR,ISEG,IX,1)*RFVCS(IVR,ISEG,IX,1)
        DO 259 ISOL=1,SOLS
  259   IMJKCS(ISOL,CHOP+2-IX)=IMJKCS(ISOL,CHOP+2-IX)+
     1    RANUM(IVR)*RSC(IVR,ISEG,IX,1)*RFKCS(IVR,ISEG,ISOL,IX,1)
  260   CONTINUE
  270   CONTINUE
C
        DO 275 IVR=2,7
        DX=RCL(IVR,ISEG)/FLOAT(RVCHOP(IVR,ISEG))
        CHOP=RVCHOP(IVR,ISEG)
        DO 265 IX=1,CHOP
        SEGV(IVR,ISEG)=SEGV(IVR,ISEG)+
     1    0.5*DX*(RANUM(IVR)*RSC(IVR,ISEG,IX,1)*
     1       RFVCS(IVR,ISEG,IX,1))+
     1    0.5*DX*(RANUM(IVR)*RSC(IVR,ISEG,IX+1,1)*
     1       RFVCS(IVR,ISEG,IX+1,1))
        DO 264 ISOL=1,SOLS
  264   SEGK(IVR,ISEG,ISOL)=SEGK(IVR,ISEG,ISOL)+
     1    0.5*DX*(RANUM(IVR)*RSC(IVR,ISEG,IX,1)*
     1       RFKCS(IVR,ISEG,ISOL,IX,1))+
     1    0.5*DX*(RANUM(IVR)*RSC(IVR,ISEG,IX+1,1)*
     1       RFKCS(IVR,ISEG,ISOL,IX+1,1))
  265   CONTINUE
  275   CONTINUE
C
C MEDULLARY RAY
C
        ISEG=1
        IVR=8
        CHOP=RVCHOP(IVR,ISEG)
        MRDIST(1) = 0.0
	DO 310 KX=2,CHOP+1
  310   MRDIST(KX) = MRDIST(KX-1) + RCL(IVR,ISEG)/FLOAT(CHOP)
        MRCHOP=CHOP
C
C - DESCENDING
C
        ISEG=1
        IVR=8
        CHOP=RVCHOP(IVR,ISEG)
        DO 320 IX=1,CHOP+1
        MRJVCS(IX)=MRJVCS(IX)+
     1    RDNUM(IVR)*RSC(IVR,ISEG,IX,1)*RFVCS(IVR,ISEG,IX,1)
        DO 319 ISOL=1,SOLS
  319   MRJKCS(ISOL,IX)=MRJKCS(ISOL,IX)+
     1    RDNUM(IVR)*RSC(IVR,ISEG,IX,1)*RFKCS(IVR,ISEG,ISOL,IX,1)
  320   CONTINUE
C
        DX=RCL(IVR,ISEG)/FLOAT(RVCHOP(IVR,ISEG))
        DO 325 IX=1,CHOP
        SEGV(IVR,ISEG)=SEGV(IVR,ISEG)+
     1    0.5*DX*(RDNUM(IVR)*RSC(IVR,ISEG,IX,1)*
     1       RFVCS(IVR,ISEG,IX,1))+
     1    0.5*DX*(RDNUM(IVR)*RSC(IVR,ISEG,IX+1,1)*
     1       RFVCS(IVR,ISEG,IX+1,1))
        DO 324 ISOL=1,SOLS
  324   SEGK(IVR,ISEG,ISOL)=SEGK(IVR,ISEG,ISOL)+
     1    0.5*DX*(RDNUM(IVR)*RSC(IVR,ISEG,IX,1)*
     1       RFKCS(IVR,ISEG,ISOL,IX,1))+
     1    0.5*DX*(RDNUM(IVR)*RSC(IVR,ISEG,IX+1,1)*
     1       RFKCS(IVR,ISEG,ISOL,IX+1,1))
  325   CONTINUE
C
C - ASCENDING
C
        ISEG=4
        IVR=8
        CHOP=RVCHOP(IVR,ISEG)
        DO 350 IX=1,CHOP+1
        MRJVCS(CHOP+2-IX)=MRJVCS(CHOP+2-IX)+
     1    RANUM(IVR)*RSC(IVR,ISEG,IX,1)*RFVCS(IVR,ISEG,IX,1)
        DO 349 ISOL=1,SOLS
  349   MRJKCS(ISOL,CHOP+2-IX)=MRJKCS(ISOL,CHOP+2-IX)+
     1    RANUM(IVR)*RSC(IVR,ISEG,IX,1)*RFKCS(IVR,ISEG,ISOL,IX,1)
  350   CONTINUE
C
        DX=RCL(IVR,ISEG)/FLOAT(RVCHOP(IVR,ISEG))
        DO 355 IX=1,CHOP
        SEGV(IVR,ISEG)=SEGV(IVR,ISEG)+
     1    0.5*DX*(RANUM(IVR)*RSC(IVR,ISEG,IX,1)*
     1       RFVCS(IVR,ISEG,IX,1))+
     1    0.5*DX*(RANUM(IVR)*RSC(IVR,ISEG,IX+1,1)*
     1       RFVCS(IVR,ISEG,IX+1,1))
        DO 344 ISOL=1,SOLS
  344   SEGK(IVR,ISEG,ISOL)=SEGK(IVR,ISEG,ISOL)+
     1    0.5*DX*(RANUM(IVR)*RSC(IVR,ISEG,IX,1)*
     1       RFKCS(IVR,ISEG,ISOL,IX,1))+
     1    0.5*DX*(RANUM(IVR)*RSC(IVR,ISEG,IX+1,1)*
     1       RFKCS(IVR,ISEG,ISOL,IX+1,1))
  355   CONTINUE
C
C FLUX PROFILES AND SUMMARY
C
        DO 410 K=1,RVCHOP(1,1)
        MEDJVCS(1)=MEDJVCS(1)+0.5*(OMJVCS(K)+OMJVCS(K+1))
        DO 409 J=1,SOLS
  409   MEDJKCS(J,1)=MEDJKCS(J,1)+0.5*(OMJKCS(J,K)+OMJKCS(J,K+1))
  410   CONTINUE
        DX=RCL(1,1)/FLOAT(RVCHOP(1,1))
        MEDJVCS(1)=MEDJVCS(1)*DX
        DO 411 J=1,SOLS
  411   MEDJKCS(J,1)=MEDJKCS(J,1)*DX
C
        DO 420 K=RVCHOP(1,1)+1,RVCHOP(2,1)
        MEDJVCS(2)=MEDJVCS(2)+0.5*(OMJVCS(K)+OMJVCS(K+1))
        DO 419 J=1,SOLS
  419   MEDJKCS(J,2)=MEDJKCS(J,2)+0.5*(OMJKCS(J,K)+OMJKCS(J,K+1))
  420   CONTINUE
        DX=(RCL(2,1)-RCL(1,1))/FLOAT(RVCHOP(2,1)-RVCHOP(1,1))
        MEDJVCS(2)=MEDJVCS(2)*DX
        DO 421 J=1,SOLS
  421   MEDJKCS(J,2)=MEDJKCS(J,2)*DX
C
        DO 430 K=1,RVCHOP(3,2)
        MEDJVCS(3)=MEDJVCS(3)+0.5*(IMJVCS(K)+IMJVCS(K+1))
        DO 429 J=1,SOLS
  429   MEDJKCS(J,3)=MEDJKCS(J,3)+0.5*(IMJKCS(J,K)+IMJKCS(J,K+1))
  430   CONTINUE
        DX=RCL(3,2)/FLOAT(RVCHOP(3,2))
        MEDJVCS(3)=MEDJVCS(3)*DX
        DO 431 J=1,SOLS
  431   MEDJKCS(J,3)=MEDJKCS(J,3)*DX
C
        DO 440 K=RVCHOP(3,2)+1,RVCHOP(4,2)
        MEDJVCS(4)=MEDJVCS(4)+0.5*(IMJVCS(K)+IMJVCS(K+1))
        DO 439 J=1,SOLS
  439   MEDJKCS(J,4)=MEDJKCS(J,4)+0.5*(IMJKCS(J,K)+IMJKCS(J,K+1))
  440   CONTINUE
        DX=(RCL(4,2)-RCL(3,2))/FLOAT(RVCHOP(4,2)-RVCHOP(3,2))
        MEDJVCS(4)=MEDJVCS(4)*DX
        DO 441 J=1,SOLS
  441   MEDJKCS(J,4)=MEDJKCS(J,4)*DX
C
        DO 450 K=RVCHOP(4,2)+1,RVCHOP(5,2)
        MEDJVCS(5)=MEDJVCS(5)+0.5*(IMJVCS(K)+IMJVCS(K+1))
        DO 449 J=1,SOLS
  449   MEDJKCS(J,5)=MEDJKCS(J,5)+0.5*(IMJKCS(J,K)+IMJKCS(J,K+1))
  450   CONTINUE
        DX=(RCL(5,2)-RCL(4,2))/FLOAT(RVCHOP(5,2)-RVCHOP(4,2))
        MEDJVCS(5)=MEDJVCS(5)*DX
        DO 451 J=1,SOLS
  451   MEDJKCS(J,5)=MEDJKCS(J,5)*DX
C
        DO 460 K=RVCHOP(5,2)+1,RVCHOP(6,2)
        MEDJVCS(6)=MEDJVCS(6)+0.5*(IMJVCS(K)+IMJVCS(K+1))
        DO 459 J=1,SOLS
  459   MEDJKCS(J,6)=MEDJKCS(J,6)+0.5*(IMJKCS(J,K)+IMJKCS(J,K+1))
  460   CONTINUE
        DX=(RCL(6,2)-RCL(5,2))/FLOAT(RVCHOP(6,2)-RVCHOP(5,2))
        MEDJVCS(6)=MEDJVCS(6)*DX
        DO 461 J=1,SOLS
  461   MEDJKCS(J,6)=MEDJKCS(J,6)*DX
C
        DO 470 K=RVCHOP(6,2)+1,RVCHOP(7,2)
        MEDJVCS(7)=MEDJVCS(7)+0.5*(IMJVCS(K)+IMJVCS(K+1))
        DO 469 J=1,SOLS
  469   MEDJKCS(J,7)=MEDJKCS(J,7)+0.5*(IMJKCS(J,K)+IMJKCS(J,K+1))
  470   CONTINUE
        DX=(RCL(7,2)-RCL(6,2))/FLOAT(RVCHOP(7,2)-RVCHOP(6,2))
        MEDJVCS(7)=MEDJVCS(7)*DX
        DO 471 J=1,SOLS
  471   MEDJKCS(J,7)=MEDJKCS(J,7)*DX
C
C BEFORE ANY SCALING, THE UNITS OF JVCS AND JKCS ARE ML/S/CM AND MMOL/S/CM
C
        SCAL=1.D3
        DO 510 K=1,OMCHOP,8
  510   WRITE (13,501) OMDIST(K),SCAL*OMJVCS(K),
     1    (SCAL*OMJKCS(J,K),J=1,4),(SCAL*OMJKCS(J,K),J=7,9),
     1    SCAL*OMJKCS(11,K),SCAL*OMJKCS(13,K),SCAL*OMJKCS(15,K)
        DO 512 K=1,IMCHOP+1,10
  512   WRITE (13,501) IMDIST(K),SCAL*IMJVCS(K),
     1    (SCAL*IMJKCS(J,K),J=1,4),(SCAL*IMJKCS(J,K),J=7,9),
     1    SCAL*IMJKCS(11,K),SCAL*IMJKCS(13,K),SCAL*IMJKCS(15,K)
        WRITE (13,502)
        DO 514 K=1,MRCHOP+1,2
  514   WRITE (13,501) MRDIST(K),SCAL*MRJVCS(K),
     1    (SCAL*MRJKCS(J,K),J=1,4),(SCAL*MRJKCS(J,K),J=7,9),
     1    SCAL*MRJKCS(11,K),SCAL*MRJKCS(13,K),SCAL*MRJKCS(15,K)
  501   FORMAT (8D16.8)
  502   FORMAT (//)
C
C BELOW HERE ARE SUMMATIONS BY SLICE AND VESSELS AND INTERNAL CHECKS ON THE DATA
C
	WRITE (14,522) (SOL(I),I=1,4),(SOL(I),I=7,9),
     1   SOL(11),SOL(13),SOL(15)
  522   FORMAT(//,4X,'SLICE',8X,'VOL',7X,10(A5,7X))
        DO 520 K=1,7
        IF (K.EQ.1) THEN
        DIST=OMDIST(1+OMCHOP/2)
        ELSE IF (K.EQ.2) THEN
        DIST=OMDIST(1+OMCHOP)
        ELSE
        DIST=IMDIST(1+((K-2)*IMCHOP/5))
        ENDIF
  520   WRITE (14,524) DIST,MEDJVCS(K),
     1   (MEDJKCS(J,K),J=1,4),(MEDJKCS(J,K),J=7,9),
     1   MEDJKCS(11,K),MEDJKCS(13,K),MEDJKCS(15,K)
  524   FORMAT(12D12.4)
C
C TOTALS FOR OM
C
        DO 530 J=1,SOLS
        TJKCS(J)=0.D0
        DO 529 K=1,2
  529   TJKCS(J)=TJKCS(J)+MEDJKCS(J,K)
  530   CONTINUE
        TJVCS=0.D0
        DO 531 K=1,2
  531   TJVCS=TJVCS+MEDJVCS(K)
        WRITE (14,535) TJVCS,
     1   (TJKCS(J),J=1,4),(TJKCS(J),J=7,9),
     1   TJKCS(11),TJKCS(13),TJKCS(15)
  535   FORMAT(5X,'OM',5X,12D12.4)
C
C TOTALS FOR IM
C
        DO 540 J=1,SOLS
        TJKCS(J)=0.D0
        DO 539 K=3,7
  539   TJKCS(J)=TJKCS(J)+MEDJKCS(J,K)
  540   CONTINUE
        TJVCS=0.D0
        DO 541 K=3,7
  541   TJVCS=TJVCS+MEDJVCS(K)
        WRITE (14,545) TJVCS,
     1   (TJKCS(J),J=1,4),(TJKCS(J),J=7,9),
     1   TJKCS(11),TJKCS(13),TJKCS(15)
  545   FORMAT(5X,'IM',5X,12D12.4)
C
C TOTALS FOR ALL
C
        DO 550 J=1,SOLS
        TJKCS(J)=0.D0
        DO 549 K=1,7
  549   TJKCS(J)=TJKCS(J)+MEDJKCS(J,K)
  550   CONTINUE
        TJVCS=0.D0
        DO 551 K=1,7
  551   TJVCS=TJVCS+MEDJVCS(K)
        WRITE (14,555) TJVCS,
     1   (TJKCS(J),J=1,4),(TJKCS(J),J=7,9),
     1   TJKCS(11),TJKCS(13),TJKCS(15)
  555   FORMAT(4X,'TOT',5X,12D12.4)
C
C WHAT FOLLOWS IS DEBUGGING AND VERIFICATION CALCULATIONS
C
        GO TO 900
C
C CHECK SUMS BY SEG VALUES
C
        SLV(1)=SEGV(1,1)+SEGV(1,4)+
     1    SEGV(2,1)+SEGV(2,4)+
     1    SEGV(3,1)+SEGV(3,4)+
     1    SEGV(4,1)+SEGV(4,4)+
     1    SEGV(5,1)+SEGV(5,4)+
     1    SEGV(6,1)+SEGV(6,4)+
     1    SEGV(7,1)+SEGV(7,4)
        SLV(2)=SEGV(3,2)+SEGV(3,3)+
     1    SEGV(4,2)+SEGV(4,3)+
     1    SEGV(5,2)+SEGV(5,3)+
     1    SEGV(6,2)+SEGV(6,3)+
     1    SEGV(7,2)+SEGV(7,3)
        DO 740 J=1,SOLS
        SLK(1,J)=SEGK(1,1,J)+SEGK(1,4,J)+
     1    SEGK(2,1,J)+SEGK(2,4,J)+
     1    SEGK(3,1,J)+SEGK(3,4,J)+
     1    SEGK(4,1,J)+SEGK(4,4,J)+
     1    SEGK(5,1,J)+SEGK(5,4,J)+
     1    SEGK(6,1,J)+SEGK(6,4,J)+
     1    SEGK(7,1,J)+SEGK(7,4,J)
        SLK(2,J)=SEGK(3,2,J)+SEGK(3,3,J)+
     1    SEGK(4,2,J)+SEGK(4,3,J)+
     1    SEGK(5,2,J)+SEGK(5,3,J)+
     1    SEGK(6,2,J)+SEGK(6,3,J)+
     1    SEGK(7,2,J)+SEGK(7,3,J)
  740   CONTINUE
C
        WRITE (14,741)
  741   FORMAT (//)
        WRITE (14,535) SLV(1),
     1   (SLK(1,J),J=1,4),(SLK(1,J),J=7,9),
     1   SLK(1,11),SLK(1,13),SLK(1,15)
        WRITE (14,545) SLV(2),
     1   (SLK(2,J),J=1,4),(SLK(2,J),J=7,9),
     1   SLK(2,11),SLK(2,13),SLK(2,15)
        WRITE (14,555) SLV(1)+SLV(2),
     1   (SLK(1,J)+SLK(2,J),J=1,4),(SLK(1,J)+SLK(2,J),J=7,9),
     1   SLK(1,11)+SLK(2,11),SLK(1,13)+SLK(2,13),SLK(1,15)+SLK(2,15)
C
C CHECK BY VESSEL NUMBER: This is a check on VASCWR
C
        DO 620 IVR=1,7
        IEND=RVCHOP(IVR,4)+1
        TV(IVR)=RDNUM(IVR)*RFVC(IVR,1,1,1)-
     1    RANUM(IVR)*RFVC(IVR,4,IEND,1)
        DO 610 J=1,SOLS
  610   TK(IVR,J)=RDNUM(IVR)*RFKC(IVR,1,J,1,1)-
     1    RANUM(IVR)*RFKC(IVR,4,J,IEND,1)
  620   CONTINUE
C
        TV(9) = TV(1)+TV(2)
        TV(10)= TV(3)+TV(4)+TV(5)+TV(6)+TV(7)
        DO 630 J=1,SOLS
        TK(9,J) = TK(1,J)+TK(2,J)
        TK(10,J)= TK(3,J)+TK(4,J)+TK(5,J)+TK(6,J)+TK(7,J)
  630   CONTINUE
C
	WRITE (14,642) (SOL(I),I=1,4),(SOL(I),I=7,9),
     1   SOL(11),SOL(13),SOL(15)
  642   FORMAT(//,4X,'VESSEL',7X,'VOL',7X,10(A5,7X))
        DO 645 IVR=1,7
  645   WRITE (14,647) IVR,TV(IVR),
     1   (TK(IVR,J),J=1,4), (TK(IVR,J),J=7,9), 
     1   TK(IVR,11),TK(IVR,13),TK(IVR,15)
  647   FORMAT(1X,'IVR=',I2,5X,12D12.4)
        IVR=9
        WRITE (14,648) TV(IVR),
     1   (TK(IVR,J),J=1,4), (TK(IVR,J),J=7,9), 
     1   TK(IVR,11),TK(IVR,13),TK(IVR,15)
  648   FORMAT(3X,'SAVR',5X,12D12.4)
        IVR=10
        WRITE (14,649) TV(IVR),
     1   (TK(IVR,J),J=1,4), (TK(IVR,J),J=7,9), 
     1   TK(IVR,11),TK(IVR,13),TK(IVR,15)
  649   FORMAT(3X,'LAVR',5X,12D12.4)
        WRITE (14,650) TV(9)+TV(10),
     1   (TK(9,J)+TK(10,J),J=1,4), (TK(9,J)+TK(10,J),J=7,9), 
     1   TK(9,11)+TK(10,11),TK(9,13)+TK(10,13),TK(9,15)+TK(10,15)
  650   FORMAT(3X,'TOTAL',4X,12D12.4)
C
C CHECK THAT THE SEGMENTAL FLUX INTEGRALS (SEG*) EQUAL THE CHANGE IN FLOWS
C
        DO 720 IVR=1,7
        IF (IVR.LE.2) THEN
        KSEG=3
        ELSE
        KSEG=1
        ENDIF
        DO 719 ISEG=1,4,KSEG
        IEND=RVCHOP(IVR,ISEG)+1
C
        IF (ISEG.LE.2) THEN
        TV(IVR)=RDNUM(IVR)*RFVC(IVR,ISEG,1,1)-
     1    RDNUM(IVR)*RFVC(IVR,ISEG,IEND,1)
        DO 705 J=1,SOLS
  705   TK(IVR,J)=RDNUM(IVR)*RFKC(IVR,ISEG,J,1,1)-
     1    RDNUM(IVR)*RFKC(IVR,ISEG,J,IEND,1)
        ELSE
        TV(IVR)=RANUM(IVR)*RFVC(IVR,ISEG,1,1)-
     1    RANUM(IVR)*RFVC(IVR,ISEG,IEND,1)
        DO 706 J=1,SOLS
  706   TK(IVR,J)=RANUM(IVR)*RFKC(IVR,ISEG,J,1,1)-
     1    RANUM(IVR)*RFKC(IVR,ISEG,J,IEND,1)
        ENDIF
C
        WRITE (14,710) IVR, ISEG
        WRITE (14,712) SEGV(IVR,ISEG),
     1    (SEGK(IVR,ISEG,J),J=1,4),(SEGK(IVR,ISEG,J),J=7,9),
     1    SEGK(IVR,ISEG,11),SEGK(IVR,ISEG,13),SEGK(IVR,ISEG,15)
        WRITE (14,714) TV(IVR),
     1   (TK(IVR,J),J=1,4), (TK(IVR,J),J=7,9), 
     1   TK(IVR,11),TK(IVR,13),TK(IVR,15)
  710   FORMAT (/,2I5)
  712   FORMAT (2X,'FLUX SUM',2X,12D12.4)
  714   FORMAT (1X,'FLOW DIFF',2X,12D12.4)
C
  719   CONTINUE
  720   CONTINUE
C
C CHECK FULL VESSELS BASED ON SEG
C
        VRV(1)=SEGV(1,1)+SEGV(1,4)
        VRV(2)=SEGV(2,1)+SEGV(2,4) 
        DO 732 K=3,7
  732   VRV(K)=SEGV(K,1)+SEGV(K,2)+SEGV(K,3)+SEGV(K,4) 
        DO 735 J=1,SOLS
        VRK(1,J)=SEGK(1,1,J)+SEGK(1,4,J)
        VRK(2,J)=SEGK(2,1,J)+SEGK(2,4,J) 
        DO 734 K=3,7
  734   VRK(K,J)=SEGK(K,1,J)+SEGK(K,2,J)+SEGK(K,3,J)+SEGK(K,4,J) 
  735   CONTINUE
C
	WRITE (14,642) (SOL(I),I=1,4),(SOL(I),I=7,9),
     1   SOL(11),SOL(13),SOL(15)
        DO 737 IVR=1,7
  737   WRITE (14,647) IVR,VRV(IVR),
     1   (VRK(IVR,J),J=1,4), (VRK(IVR,J),J=7,9), 
     1   VRK(IVR,11),VRK(IVR,13),VRK(IVR,15)
C
        RETURN
  900   CONTINUE
        END
